%\documentclass[12pt,a4paper]{amsart}
\documentclass[11pt,a4paper]{article}
%\ifx\pdfpageheight\undefined\PassOptionsToPackage{dvips}{graphicx}\else%
%\PassOptionsToPackage{pdftex}{graphicx}
\PassOptionsToPackage{pdftex}{color}
%\fi

%\usepackage{diagrams}

%\usepackage[all]{xy}
\usepackage{url}
\usepackage[utf8]{inputenc}
\usepackage{verbatim}
\usepackage{latexsym}
\usepackage{amssymb,amstext,amsmath,amsthm}
\usepackage{epsf}
\usepackage{epsfig}
% \usepackage{isolatin1}
\usepackage{a4wide}
\usepackage{verbatim}
\usepackage{proof}
\usepackage{latexsym}
%\usepackage{mytheorems}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}{Lemma}[theorem]
\newtheorem{proposition}{Proposition}[theorem]
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{remark}{Remark}[theorem]
\newtheorem{TODO}{TODO}[theorem]

\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}


%%%%%%%%%copied from SymmetryBook by Marc

% hyperref should be the package loaded last
%% \usepackage[backref=page,
%%             colorlinks,
%%             citecolor=linkcolor,
%%             linkcolor=linkcolor,
%%             urlcolor=linkcolor,
%%             unicode,
%%             pdfauthor={CAS},
%%             pdftitle={Symmetry},
%%             pdfsubject={Mathematics},
%%             pdfkeywords={type theory, group theory, univalence axiom}]{hyperref}
% - except for cleveref!
\usepackage[capitalize]{cleveref}
%\usepackage{xifthen}
\usepackage{xcolor}
\definecolor{linkcolor}{rgb}{0,0,0.5}

%%%%%%%%%
\def\oge{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\langle\!\langle\,$}}
\def\feg{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\,\rangle\!\rangle$}}

%%%%%%%%%
\newcommand\myfrac[2]{
 \begin{array}{c}
 #1 \\
 \hline \hline
 #2
\end{array}}


\newcommand*{\Scale}[2][4]{\scalebox{#1}{$#2$}}%
\newcommand*{\Resize}[2]{\resizebox{#1}{!}{$#2$}}

\newcommand{\II}{\mathbb{I}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\mkbox}[1]{\ensuremath{#1}}


\newcommand{\Id}{\mathsf{Id}}
\newcommand{\conv}{=}
%\newcommand{\conv}{\mathsf{conv}}
\newcommand{\lam}[2]{{\langle}#1{\rangle}#2}
\def\NN{\mathsf{N}}
\def\UU{\mathsf{U}}
\def\JJ{\mathsf{J}}
\def\Level{\mathsf{Level}}
\def\List{\mathsf{List}}
\def\Cons{\mathsf{Cons}}
\def\Nil{\mathsf{Nil}}
%\def\Type{\hbox{\sf Type}}
\def\ZERO{\mathsf{0}}
\def\SUCC{\mathsf{S}}

\newcommand{\type}{\mathsf{type}}
\newcommand{\LAM}{\lambda}
\newcommand{\APP}{\mathsf{app}}
\newcommand{\mypi}[3]{\Pi_{#1:#2}#3}
\newcommand{\mylam}[3]{\lambda_{#1:#2}#3}
\newcommand{\mysig}[3]{\Sigma_{#1:#2}#3}
\newcommand{\N}{\mathsf{N}}
\newcommand{\Set}{\mathsf{Set}}
\newcommand{\El}{\mathsf{El}}
%\newcommand{\U}{\mathsf{U}} clashes with def's in new packages
\newcommand{\T}{\mathsf{T}}
\newcommand{\sT}{\mathsf{t}}
\newcommand{\Usuper}{\UU_{\mathrm{super}}}
\newcommand{\Tsuper}{\T_{\mathrm{super}}}
%\newcommand{\conv}{\mathrm{conv}}
\newcommand{\idtoeq}{\mathsf{idtoeq}}
\newcommand{\isEquiv}{\mathsf{isEquiv}}
\newcommand{\ua}{\mathsf{ua}}
\newcommand{\UA}{\mathsf{UA}}
%\newcommand{\Level}{\mathrm{Level}}
\def\Constraint{\mathsf{Constraint}}
\def\Ordo{\mathcal{O}}

\newcommand{\Con}{\mathsf{ Con}}
\newcommand{\Elem}{\mathsf{Elem}}
\newcommand{\Type}{\mathsf{Type}}
\newcommand{\id}{\mathsf{id}}
\newcommand{\pp}{\mathsf{p}}
\newcommand{\qq}{\mathsf{q}}

\def\Ctx{\mathrm{Ctx}}
\def\Ty{\mathrm{Ty}}
\def\Tm{\mathrm{Tm}}

\def\CComega{\mathrm{CC}^\omega}
\setlength{\oddsidemargin}{0in} % so, left margin is 1in
\setlength{\textwidth}{6.27in} % so, right margin is 1in
\setlength{\topmargin}{0in} % so, top margin is 1in
\setlength{\headheight}{0in}
\setlength{\headsep}{0in}
\setlength{\textheight}{9.19in} % so, foot margin is 1.5in
\setlength{\footskip}{.8in}

% Definition of \placetitle
% Want to do an alternative which takes arguments
% for the names, authors etc.

\newcommand{\natrec}{\mathsf{natrec}}
%\rightfooter{}
\newcommand{\set}[1]{\{#1\}}
\newcommand{\sct}[1]{[\![#1]\!]}
%\usepackage{diagrams}
\usepackage{color}
\newcommand\coloremph[2][red]{\textcolor{#1}{\emph{#2}}}
\newcommand\norm[1]{\left\lVert #1 \right\rVert}
\newcommand\greenemph[2][green]{\textcolor{#1}{\emph{#2}}}
\newcommand{\EMP}[1]{\emph{\textcolor{red}{#1}}}




\begin{document}

\title{Type Theory with a Cumulative Hierarchy of Universes}

\author{}
\date{}
\maketitle

%\begin{abstract}
%\end{abstract}

\section{Introduction}\label{sec:intros}

 There are two different ways to formulate the notion of universe in type theory. Martin-LÃ¶f's first versions \cite{martinlof:72,martinlof:predicative,martinlof:hannover,martinlof:padova} were formulated \`a la Russell, where a universe is seen as a type of types. Later \cite{martinlof:padova}, an alternative version \`a la Tarski, where a universe is seen as a type of names of types and comes with a decoding function, was also introduced.
 
Some recent works \cite{Assaf14,Thire20}\footnote{PD: Assaf provides translations back and forth between the two systems, but the clause for application in the translation from Russell to Tarski seems incorrect or at least unclear, since the RHS makes use of data not present in the LHS.} show the equivalence between these two formulations, but these arguments do not apply to formulations of type theory with typed equality judgements \cite{martinlof:hannover,martinlof:padova}. In this paper we show the equivalence for this case by a method due to Streicher  \cite{Streicher:semtt} that seems simpler
and more transparent than the one in \cite{Assaf14,Thire20}.

We quote from Streicher, p 246, concerning his theorem 4.10 and it's consquence theorem 4.11:
\begin{quotation}
This theorem, although interesting in itself, has in particular the consequence that type information in application terms is redundant, i.~e.~if $t$ and $s$ are terms which are different only w.r.t. the type information of subterms which are application terms then $t$ and $s$ are provably equal.
\end{quotation}
We shall here show that Streicher's technique can be extended to show the equivalence of the Russell and Tarski formulations of a hierarchy of universes.

Streicher's argument relies on  basic properties of such a type system (such as subject reduction and normalization). Such properties were assumed in \cite{Streicher:semtt}, but they are now known to be provable
for systems with a predicative hierarchy of universes \cite{coquand:sophia,abel:neworleans,abel:wroclaw,coq18}.

The argument is as follows. There is a natural forgetful map from the Tarski version to the Russell version. Modulo the (known) meta-properties of both system, one can show that any Russell judgement can be lifted in a unique way to a Tarski judgement.\footnote{PD: Cf the sketch of a proof using the initial $\Pi\UU$-cwf of normal forms in {\tt initial-cwf-normal-forms.tex} in the same directory.}
\footnote{PD: Assume that we have a function $nbe_1$ that maps terms in $T_1$ to their normal forms with the property that $a = b : A$ iff $nbe_1(a)$ and $nbe_1(b)$ are syntactically equal (and similarly for types). And similarly $nbe_2$ for $T_2$. Then we can prove that the forgetful map |-| from Tarski-judgments in $T_1$ to Russell-judgments in $T_2$ has a unique inverse, by proving the property for normal terms and by showing that $|nbe_1(a)|$ is syntactically equal to $nbe_2(|a|)$. }

\section{An annotated type theory with universes \`a la Tarski}

We now present the system $T_1$ of type theory with $\Pi$-types with annotated application and abstraction and an external hierarchy of Tarski style universes $\UU_n$ with decoding maps $\T_n$. For simplicity we only consider closure under $\Pi$-types. 

The syntax\footnote{PD: 
I suggest being consistent about whether to write e g $\Pi(A,B), \T_n~a$ 
or $\Pi(A,B),\T_n(a)$, etc, and vote for the latter
} 
for types is
$$
A,B~::=~\Pi({A},B)~|~\UU_n~|~\T_n a
$$
and the syntax for terms is
$$
a,b~::=~v_i~|~\APP(A,B,c,a)~|~\LAM(A,B,b)~|~\Pi^n~ a~b~|~\UU^k_n~|~\sT^k_n a~
$$
Note that we present a system with de Bruijn variables and implicit substitution.
Here $v_i$ is a variable with de Bruijn index $i$. In this system, applications $\APP(A,B,c,a)$ and abstractions $\LAM(A,B,b)$ are annotated with the argument type $A$ and the result type family $B$. Moreover, $\Pi^n~ a~b$ are codes for $\Pi$-types in $\UU_n$, $\UU^k_n$ is the code for $\UU_k$ in $\UU_n$, where $k < n$, and $\sT^k_n a$ is the lifting of an element $a$ in $\UU_k$ to $\UU_n$. We thus consider a cumulative hierarchy of universes.

The theory $T_1$ is set up to facilitate the construction of an initial category with families with extra structure for $\Pi$-types and a cumulative hierarchy of universes, see appendix. (We also need to define equality of contexts $\Gamma = \Gamma'$ and $\gamma = \gamma' : \Delta \to \Gamma$.)  Brunerie et al \cite{brunerie:initial} implemented a proof in Agda that a similar calculus is initial in a category of contextual categories with suitable extra structure. Note that initial categories with families (and contextual categories) with suitable extra structure can also be constructed from a calculus of explicit substitutions  \cite{casellan:tlca15}.

In the following section we will define the theory $T_2$ of type theory with $\Pi$-types and a cumulative hierarchy of universes \`a la Russell. In this system the application $c\,a$ is not annotated and the abstraction $\lambda A b$ is only annotated with the argument type $A$ and not the result family $B$. We will prove that $T_1$ and $T_2$ are isomorphic 
categories with families with extra structure for $\Pi$-types and a cumulative hierarchy of universes (defined in the appendix), and thus the $T_2$ is initial in this category too.
\medskip

We define weakenings\footnote{PD: changed from "renamings"} $r$ and one place substitutions $\sigma$:
$$
r~::=~\pp~|~r^+~~~~~~~~~\sigma~::=~[a]~|~\sigma^+~~~~~~~~~~\alpha~::=~r~|~\sigma
$$
We first define the actions of a weakening on types $Ar$ and terms $ar$ and then the actions of a substitution on types $A\sigma$ and terms $a\sigma$ by induction on $A$ and $a$. 

The actions on variables are
$$
v_i\pp = v_{i+1}~~~~~v_0\alpha^+ = v_0~~~v_{i+1}\alpha^+ = (v_i\alpha)\pp~~~~~v_0[a] = a~~~v_{i+1}[a] = v_i\footnote{PD: added}
$$
We can then define $A\alpha$ (resp. $a\alpha$) by induction on $A$ (resp. $a$).
For instance, $(\Pi(A,B))\alpha = \Pi(A\alpha,B\alpha^+)$
and $\APP(A,B,c,a)\alpha = \APP(A\alpha,B\alpha^+,c\alpha,a\alpha)$.

\begin{lemma}
  We have $(B[a])\alpha = B\alpha^+[a\alpha]$ and $(b[a])\alpha = b\alpha^+[a\alpha]$.
\end{lemma}

\medskip

The type system describes how to derive judgements of the form $\Gamma\vdash$ and $\Gamma\vdash J$ where $J$ is of the form
$A~\type$ or $a:A$ or $A=B$ or $a=b : A$.

\medskip

The judgment $\Gamma\vdash$ expresses that $\Gamma$ is a well-formed context. $\Gamma\vdash A$ expresses that $A$ is a type in context $\Gamma$. First, we have the following general typing rules. These are common to the present system and the Russell-style system to be presented later.
\begin{figure}[H]
  \caption{Context formation rules} 
  $$
\frac{}{()\vdash}~~~~~~~\frac{\Gamma\vdash A}{\Gamma.A\vdash}
$$
\end{figure}
\begin{figure}[H]
  \caption{Typing rules for variables} 
  $$
\frac{\Gamma\vdash A}{\Gamma.A\vdash v_0:A\pp}~~~~~~~
\frac{\Gamma\vdash v_i:A~~~~~~~\Gamma\vdash B}{\Gamma.B\vdash v_{i+1}:A\pp}~~~~~~~
$$
\end{figure}
We may write $A~\type~(\Gamma)$ rather than $\Gamma\vdash A$ and may omit the global context $\Gamma$, and employ this convention for the judgments $\Gamma \vdash a : A$ and $\Gamma \vdash a = b : A$ too. With this convention the typing rules for variables are written:
\begin{figure}[h]
\caption{Typing rules for variables where the global context is omitted}
$$
\frac{A~\type}{v_0:A\pp}~~~~~~~
\frac{v_i:A~~~~~~~B~\type}{v_{i+1}:A\pp\ (B)}~~~~~~~
$$
\end{figure}

The typing rules for $\Pi$-types and universes are as follows:
\footnote{PD: I have restructured the rules a little. First, we can show the general rules which are common to both systems. Then the rules for annotated $\Pi$-types. And finally, the rules for Tarski-style universes. Then we only need to show the rules for non-annotated $\Pi$-types and the rules for Russell-style universes in the following section.}
\begin{figure}[H]
  \caption{Typing rules for annotated $\Pi$-types and universes \`a la Tarski}\label{type-Tarski}
%$$
%  \frac{A~\type}{v_0:A\pp~(A)}
%  ~~~~~~
%  \frac{v_i:A~~~~B~\type}{v_{i+1}:A\pp~(B)}
%$$
$$
    \frac{A~\type~~~~~~B~\type~(A)}{\Pi(A,B)~\type}
 ~~~~~~~~~
\frac{b:B~(A)}{\LAM(A,B,b):\Pi(A,B)}
~~~~~~~~
\frac{c:\Pi(A,B)~~~~~~a:A}
     {\APP(A,B,c,a):B[a]}
$$
$$
\frac{}{\UU_n~\type}~~~~~~
\frac{a:\UU_{n}}{\T_{n}(a)~\type}~~~~~~
\frac{a:\UU_{n}~~~~~~b:\UU_n~(\T_{n}(a))}
     {\Pi^{n} a b:\UU_{n}}
        ~~~~~~~
\frac{}{\UU^{n}_m:\UU_{n}}m<n
~~~~~~~~~\frac{a:\UU_{m}}{\sT_{m}^{n}(a):\UU_{n}}m<n
$$
\end{figure}

We write $\conv$ for definitional equality (or conversion).
The main conversion rules\footnote{PD: don't we have them all now? We could also consider presenting the system in terms of the per-rules. This makes sense if our aim is to present as compact a system as possible. With the per-rules the $\xi$-rule subsumes $\Pi$-introduction.} are shown in Figure \ref{conv-Tarski}.

\begin{figure}[H]
  \caption{Conversion rules for \`a la Tarski}\label{conv-Tarski}
$$
\frac{ a:A~~~~~~ A~ \conv~ B}{ a:B}~~~~~~~~~
\frac{ a ~\conv~a':A~~~~~~ A  ~\conv~ B}{ a ~\conv~a':B}
$$
$$
\frac{A~=~B~~~~~A~=~C}{B~=~C}~~~~~~~~~\frac{A~\type}{A~=~A}~~~~~~~~~
\frac{a~=~b:A~~~~~a~=~c:A}{b~=~c:A}~~~~~~~~~\frac{a:A}{a~=~a:A}
$$
$$
\frac{A~=~A'~~~~~~B~=~B'~(A)}{\Pi(A,B)~=~\Pi(A',B')}~~~~~~~~
\frac{c~=~c':\Pi(A,B)~~~~~~a~=~a':A~~~~~~A~=~A'~~~~~~~~B~=~B'}{\APP(A,B,c,a)~=~\APP(A',B',c',a'):B[a]}
$$
%$$
%\frac{A~=~A'~~~~~~B~=~B'~(A)~~~~~b~=~b':B~(A)}{\LAM(A,B,b)~=~\LAM(A',B',b'):\Pi(A,B)}
%$$
$$
\frac{b:B~(A)~~~~~~~~ a:A}{ \APP(A,B,\LAM(A,B,b),a)  ~\conv~ b[a]:B[a]}
~~~~~~~
\frac{f : \Pi(A,B)}{ f = \lambda(A,B,\APP(A\pp,B\pp^+,f\pp,v_0)) : \Pi(A,B)}\footnote{PD: corrected to annotated $\APP$}
$$
$$
\frac{a~=~a':\UU_n}{\T_n(a)~=~\T_n(a')}~~~~~~
\frac{a~=~a':\UU_n}{\sT_n^p(a)~=~\sT_n^p(a'):\UU_p}n<p
$$
$$
\frac{a:\UU_n~~~~~~b:\UU_n~(\T_n(a))}{\T_{n}~(\Pi^{n} a b) = \Pi({\T_{n}(a)},{\T_{n}(b)})}
~~~~~~~~\frac{a:\UU_n~~~~~~b:\UU_n~(\T_n(a))}{\sT_{n}^{p}~(\Pi^{n} a b) = \Pi^{p} \sT_{n}^{p}(a) \sT_{n}^{p}(b):\UU_p}n< p~
$$
$$
\frac{}{\T_{n}({\UU^{n}_m}) = \UU_{m}}m<n~~~~~~~~~~ \frac{}{\sT_{n}^{p}~(\UU^{n}_m) = \UU^p_m:\UU_p}m<n<p
$$
$$
\frac{a:\UU_m}{\T_n(\sT_{m}^{n}(a)) = \T_{m}(a)}n<m~~~~~~
\frac{a:\UU_m}{\sT_{n}^p(\sT_{m}^n(a)) = \sT_m^p(a):\UU_p}{m<n<p}
$$
\end{figure}

We define $\alpha:\Delta\rightarrow\Gamma$ by induction on $\alpha$.
We have $\pp:\Gamma.A\rightarrow\Gamma$ and $[a]:\Gamma\rightarrow \Gamma.A$ and
$\alpha^+:\Delta.A\alpha\rightarrow\Gamma.A$ if $\alpha:\Delta\rightarrow\Gamma$ and $\Gamma\vdash A~\type$.

\begin{lemma}\label{subst}
  The following rule is admissible: if $\Gamma\vdash J$ and $\alpha:\Delta\rightarrow\Gamma$
  then $\Delta\vdash J\alpha$.
\end{lemma}

Using the techniques developed in \cite{coquand:sophia,abel:wroclaw,coq18},
we can also show that $\Pi$ is one-to-one. An important consequence is closure under $\beta$-reduction.

\begin{lemma}
  If $\APP(A,B,\LAM(A',B',b),a):T$ then $b[a]:T$.
\end{lemma}

\begin{proof}
  We first get that $\LAM(A',B',b)$ has to be of type $\Pi(A,B)$ and then that $\Pi(A,B)~\conv~\Pi(A',B')$.
  Using that $\Pi$ is one-to-one, we get $A=A'$ and $B=B'~(A)$. We then have $b:B~(A)$ and $T = B[a]$.
  We deduce $b[a]:B[a]$ by substitution and Lemma \ref{subst} and $b[a]:T$ by the type equality rule.
\end{proof}

\section{Rules for a type theory $T_2$ with universes \`a la Russell}

The syntax is now for types and terms
$$
A,B,a,b~::=~v_i~|~c~a~|~\lambda~A~ b~|~\Pi~{A}~B~|~\UU_n
$$
Note that the application $c~a$ is not annotated by types, and that the abstraction $\lambda~A~ b$ only has one type argument, not two.

The typing and conversion rules are in Figures \ref{type-Russell} and \ref{conv-Russell}.\footnote{PD: what about splitting up rules into those which are the same for Russell and Tarski and those which are different?}

\begin{figure}[H]
  \caption{Typing rules for \`a la Russell}\label{type-Russell}$$
  \frac{A~\type}{v_0:A\pp~(A)}~~~~~~\frac{v_n:A~~~~B~\type}{v_{n+1}:A\pp~(B)}
$$
$$
\frac{A~\type~~~~~~B~\type~(A)}{\Pi(A,B) \type}
~~~~~~~\frac{b:B~(A)}{\lambda(A,B,b):\Pi(A,B)}~~~~~~~~
\frac{c:\Pi(A,B)~~~~~~a:A}{\APP(A,B,c,a):B[a]}~~~~~~
$$     
$$
\frac{}{\UU_n~\type}~~~~~~
\frac{A:\UU_{n}}{A~\type}
~~~~~~
\frac{A:\UU_{n}~~~~~~B:\UU_n~(A)}
     {\Pi(A,B):\UU_{n}}
~~~~~~~
\frac{}{\UU_m:\UU_{n}}m<n
~~~~~~~
\frac{A:\UU_{n}}{A:\UU_{p}}n<p
$$
$$
\frac{}{\UU_n:\UU_{n+1}}~~~~~~~
\frac{A:\UU_{n}}{A:\UU_{n+1}}
\footnote{PD: old versions, should we keep them? Uniqueness of type?}
$$
\end{figure}

\begin{figure}[H]
  \caption{Conversion rules for Russell-style}\label{conv-Russell}
$$
\frac{ a:A~~~~~~ A~ \conv~ B}{ a:B}~~~~~~~~~
\frac{ a ~\conv~a':A~~~~~~ A  ~\conv~ B}{ a ~\conv~a':B}
$$
$$
\frac{A~=~B~~~~~A~=~C}{B~=~C}~~~~~~~~~\frac{A~\type}{A~=~A}~~~~~~~~~
\frac{a~=~b:A~~~~~a~=~c:A}{b~=~c:A}~~~~~~~~~\frac{a:A}{a~=~a:A}
$$
$$
\frac{A~=~A'~~~~~~B~=~B'~(A)}{\Pi(A,B)~=~\Pi(A',B')}~~~~~~~~
\frac{c~=~c':\Pi(A,B)~~~~~~a~=~a':A}{\APP(A,B,c,a)~=~\APP(A',B',c',a'):B[a]}
$$
$$
%\frac{A~=~A'~~~~~~b~=~b':B~(A)}{\lambda(A,B,b)~=~\lambda(A',B',b'):\Pi(A,B)}~~~~~~~~
\frac{b:B~(A)~~~~~~~~ a:A}{ \APP(A,B,\lambda(A,B,b),a)  ~\conv~ b[a]:B[a]}
~~~~~~~
\frac{f : \Pi(A,B)}{ f = \lambda(A,B,\APP(A\pp,B\pp^+,f\pp,v_0)) : \Pi(A,B)}
$$
$$
\frac{A~=~A':\UU_n}{A~=~A'}~~~~~~
\frac{A~=~A':\UU_n}{A~=~A':\UU_p}n<p
$$
\end{figure}
\footnote{PD: added the two last rules}


\medskip

We have an operation which removes the annotation from $T_1$ to $T_2$.
$$
|\UU_n| = \UU_n~~~~~~~~|\Pi(A,B)| = \Pi(|A|,|B|)~~~~~~~~~|\T_n(a)| = |a|
$$
$$
|\APP(A,B,c,a)| = \APP(|A|,|B|,|c|,|a|)~~~~~~|v_i| = v_i~~~~~~|\LAM(A,B,b)| = \lambda(|A|,|B|,|b|)~~~~~|\sT_m^n(a)| = |a|
~~~~~~~|\UU^n_m| = \UU_m
$$
The following remark has a direct proof.

\begin{lemma}
  If $\Gamma\vdash J$ in $T_1$ then $|\Gamma|\vdash |J|$ in $T_2$.
\end{lemma}


\section{Equivalence between $T_1$ and $T_2$}

\begin{lemma}
  If $\Gamma\vdash A$ and $\Gamma\vdash B$ and $|A|=|B|$ (syntactic equality) then $\Gamma\vdash A = B$.

    If $\Gamma\vdash u_0:A_0$ and $\Gamma\vdash u_1:A_1$ and $|u_0| = |u_1|$ then
  \begin{itemize}
    \item either $\Gamma\vdash A_0 = A_1$
      and $\Gamma\vdash u_0 = u_1:A_0$
    \item or $\Gamma\vdash A_0 = \UU_{n_0}$ and $\Gamma\vdash A_1 = \UU_{n_1}$ and $\Gamma\vdash u_0 = \sT_k^{n_0}(v_0) : A_0$
      and $\Gamma\vdash u_1 = \sT_k^{n_1}(v_1):A_1$ and $\Gamma\vdash v_0 = v_1 :U_k$.
  \end{itemize}
\end{lemma}
\footnote{PD: Note that we have a type label for lambda also in $T_2$, so that the following is not a counterexample. Let $A = \UU_0 \to \UU_k, t = \lambda_{A,B} x.\T^k_0(x), B =  \UU_0 \to \UU_l, u = \lambda_{A,B} x.\T^l_0(x)$. Then $|t| \neq |u|$. However, we can reconstruct the Tarski normal form even without the type label, since this is available in the typing rule.}

 The proof is direct by mutual induction.

\begin{corollary}
  If $\Gamma\vdash A$ and $\Gamma\vdash B$ and $|A|=|B|$ (syntactic equality) then $\Gamma\vdash A = B$.

    If $\Gamma\vdash u_0:A_0$ and $\Gamma\vdash u_1:A_1$ and $|u_0| = |u_1|$ and $|A_0| = |A_1|$ then $\Gamma\vdash A_0=A_1$ and $\Gamma\vdash u_0 = u_1:A_0$.
\end{corollary}



\begin{theorem}
  If $\Gamma\vdash J$ in the system $T_2$ then there exists a unique, up to conversion, judgement $\Gamma_1\vdash J_1$
  in the system $T_1$ such that $|\Gamma_1| = \Gamma$ and $|J_1| = J$.
\end{theorem}
\footnote{PD:  A direct construction first maps $\Gamma_1\vdash J_1$ to $|\Gamma_1|\vdash |J_1|$ and then normalizes to $\Gamma_2 \vdash J_2$ and then applies the algorithm which reconstructs the Tarski derivation: $\Gamma_2^*\vdash J_2^*$. To prove that this is the unique up to conversion judgment we also need to show that erasure commutes with normalization. It would actually be nicer to state that $|-|$ and $^*$ form an isomorphism between $T_1$ and $T_2$, and that both are initial.}
\footnote{PD: What happens if you directly try reconstruct the Tarski derivation from the Russell derivation without normalization? The algorithm is essentially the same although now applied to all derivations, not just normal ones. And it is also applied to the equality judgments. The problem is now that a Russell judgment may have many derivations, and how do we ensure that they are all translated to the same Tarski judgment up to conversion?  Motto: when you map from judgments you should map from normal judgments, but mapping from raw terms can be from arbitrary terms.}

\section{Addition of data types}

The proof extends to the corresponding systems with data types.

For the case of the list types $\List~A$ with constructors $\Nil$ and $\Cons$, we can define in the Russell system
$$
f~:~\List~\UU_0~\rightarrow~\List~\UU_1~~~~~~~~~~~
f~\Nil = \Nil~~~~~~f~(\Cons~x~xs) = \Cons~x~(f~xs)
$$
which can be lifted to in the Tarski version
$$
f~:~\List~\UU_0~\rightarrow~\List~\UU_1~~~~~~~~~~~
f~\Nil = \Nil~~~~~~f~(\Cons~x~xs) = \Cons~(\sT_0^1 x)~(f~xs)
$$
and is extensionally the identity function.
In the Russell system, in the context  $xs:\List~\UU_0$,
we do have $f~xs:\List~\UU_1$ but we do \EMP{not} have $xs:\List~\UU_1$

\medskip

     Similarly, the system $T_2$ is \EMP{not} closed under $\eta$-reduction. In the context
     $x:\UU_1\rightarrow\UU_1$, 
     we have $\lambda_{y:\UU_0}x~y:\UU_0\rightarrow\UU_2$ but we do \EMP{not} have
     $x:\UU_0\rightarrow\UU_2$.\footnote{PD: think about this. What does this mean for the PER-formulation of the system?}




\section{Initial models}

It is possible to present type theory with cumulative hierarchy of universe as a generalised algebraic theory.
The system $T_1$ can be used to present the initial/term model of this theory, following the method presented in \cite{Streicher:semtt}
(method which was formalised in the work \cite{brunerie:initiality}).
Our result shows that Russell's system $T_2$ can be used as well to present this initial/term model.



\bibliographystyle{plain}
\bibliography{refs}

\end{document}
