\documentclass[11pt,a4paper]{article}
%\ifx\pdfpageheight\undefined\PassOptionsToPackage{dvips}{graphicx}\else%
%\PassOptionsToPackage{pdftex}{graphicx}
\PassOptionsToPackage{pdftex}{color}
%\fi

%\usepackage{diagrams}

%\usepackage[all]{xy}
\usepackage[disable]{todonotes}
\usepackage{url}
\usepackage[utf8]{inputenc}
\usepackage{verbatim}
\usepackage{latexsym}
\usepackage{amssymb,amstext,amsmath,amsthm}
\usepackage{epsf}
\usepackage{epsfig}
\usepackage{float}
\usepackage{a4wide}
\usepackage{verbatim}
\usepackage{proof}
\usepackage{latexsym}
%\usepackage{mytheorems}
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}{Lemma}[theorem]
\newtheorem*{proposition*}{Proposition}%[theorem]
\theoremstyle{definition}
%\newtheorem{definition}[theorem]{Definition}
%\newtheorem{remark}{Remark}[theorem]
\newtheorem{TODO}{TODO}[theorem]
\newtheorem{remark}{Remark}
\newtheorem{definition}{Definition}
\newtheorem{example}{Example}
\newtheorem{conjecture}{Conjecture}

\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}


%%%%%%%%%copied from SymmetryBook by Marc

% hyperref should be the package loaded last
\usepackage[backref=page,
            colorlinks,
            citecolor=linkcolor,
            linkcolor=linkcolor,
            urlcolor=linkcolor,
            unicode,
            pdfauthor={BCDE},
            pdftitle={Universes},
            pdfsubject={Mathematics},
            pdfkeywords={type theory, universes}]{hyperref}
% - except for cleveref!
\usepackage[capitalize,noabbrev]{cleveref}
%\usepackage{xifthen}
\usepackage{xcolor}
\definecolor{linkcolor}{rgb}{0,0,0.5}

%%%%%%%%%
\def\oge{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\langle\!\langle\,$}}
\def\feg{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\,\rangle\!\rangle$}}

%%%%%%%%%

\newcommand{\mkbox}[1]{\ensuremath{#1}}
\newcommand{\eraser}[1]{}

\newcommand{\conv}{=}
%\newcommand{\conv}{\mathsf{conv}}

\newcommand{\Id}{\mathsf{Id}}
\newcommand{\Eq}{\mathsf{Eq}}
\newcommand{\id}{\mathsf{id}}
\newcommand{\NN}{\mathsf{N}}
\newcommand{\Nat}{\mathbb{N}}
\newcommand{\UU}{\mathsf{U}}
\newcommand{\JJ}{\mathsf{J}}
\newcommand{\AgdaLevel}{\mathsf{Level}}
\newcommand{\Level}{\mathsf{level}}
\newcommand{\Lev}{{\mathbb{L}}}
%\newcommand{\Type{\hbox{\sf Type}}
\newcommand{\ZERO}{\mathsf{0}}
\newcommand{\SUCC}{\mathsf{S}}
\newcommand{\valid}{\mathsf{valid}}
\newcommand{\level}{\mathsf{level}}
%\newcommand{\type}{\mathsf{type}}
\newcommand{\const}{\mathsf{const}}
\newcommand{\lam}[1]{{\langle}#1{\rangle}}
\newcommand{\mylam}[3]{\lambda_{#1:#2}#3}
\newcommand{\mypi}[3]{\Pi_{#1:#2}#3}
\newcommand{\Upi}[3]{\Pi^{#1}\,#2\,#3}
\newcommand{\mysig}[3]{\Sigma_{#1:#2}#3}
\newcommand{\Usig}[3]{\Sigma^{#1}\,#2\,#3}
\newcommand{\app}[2]{{#1\,#2}} % many applications still hard-coded with ~
\newcommand{\Sapp}[1]{\sapp{\SUCC}{#1}}
\newcommand{\sapp}[2]{{#1(#2)}} % strict app for Id, refl, J, natrec, not S (!)
\newcommand{\Idapp}[3]{\sapp{\Id}{#1,#2,#3}}
\newcommand{\Idnapp}[4]{\sapp{\Id^#4}{#1,#2,#3}}
\newcommand{\NRapp}[4]{\sapp{\RR}{#1,#2,#3,#4}}
\newcommand{\Rfapp}[2]{\sapp{\refl}{#1,#2}}
\newcommand{\Japp}[6]{\sapp{\JJ}{#1,#2,#3,#4,#5,#6}}
\newcommand{\RR}{\mathsf{R}}
%\newcommand{\Set}{\mathsf{Set}}
\newcommand{\Group}{\mathsf{Group}}
%\newcommand{\El}{\mathsf{El}}
%\newcommand{\T}{\mathsf{T}}
%\newcommand{\Usuper}{\UU_{\mathrm{super}}}
%\newcommand{\Tsuper}{\T_{\mathrm{super}}}
%\newcommand{\idtoeq}{\mathsf{idtoeq}}
%\newcommand{\isEquiv}{\mathsf{isEquiv}}
%\newcommand{\Equiv}{\mathsf{Equiv}}
\newcommand{\isContr}{\mathsf{isContr}}
%\newcommand{\ua}{\mathsf{ua}}
%\newcommand{\UA}{\mathsf{UA}}
%\newcommand{\natrec}{\mathsf{natrec}}
%\newcommand{\set}[1]{\{#1\}}
%\newcommand{\sct}[1]{[\![#1]\!]}
%\newcommand{\refl}{\mathsf{refl}}
\newcommand{\ttt}[1]{\text{\tt #1}}

\newcommand{\Constraint}{\mathsf{Constraint}}
\newcommand{\Ordo}{\mathcal{O}}
\newcommand{\AFu}{\mathcal{A}}
\newcommand{\Fu}{\mathit{Fu}}

\newcommand{\Ctx}{\mathrm{Ctx}}
\newcommand{\Sub}{\mathrm{Hom}}
\newcommand{\Ty}{\mathrm{Ty}}
\newcommand{\Tm}{\mathrm{Tm}}
\newcommand{\Lctx}{\mathrm{Lctx}}
\newcommand{\Lsub}{\mathrm{Lhom}}
\newcommand{\Ltm}{\mathrm{Ltm}}
\newcommand{\op}{\mathrm{op}}

\newcommand{\CComega}{\mathrm{CC}^\omega}
\setlength{\oddsidemargin}{0in} % so, left margin is 1in
\setlength{\textwidth}{6.27in} % so, right margin is 1in
\setlength{\topmargin}{0in} % so, top margin is 1in
\setlength{\headheight}{0in}
\setlength{\headsep}{0in}
\setlength{\textheight}{9.19in} % so, foot margin is 1.5in
\setlength{\footskip}{.8in}

% Definition of \placetitle
% Want to do an alternative which takes arguments
% for the names, authors etc.

\newcommand\myfrac[2]{
 \begin{array}{c}
 #1 \\
 \hline \hline
 #2
\end{array}}

\def\levelctx{\mathrm{lctx}}
\def\lhom{\mathrm{lhom}}
\def\psiab{\psi_{\alpha\beta}}

\newcommand*{\Scale}[2][4]{\scalebox{#1}{$#2$}}%
\newcommand*{\Resize}[2]{\resizebox{#1}{!}{$#2$}}

\newcommand{\II}{\mathbb{I}}
\newcommand{\refl}{\mathsf{r}}
\newcommand{\MB}[1]{{\color{red}{#1}}}
%\newcommand{\mkbox}[1]{\ensuremath{#1}}


%\newcommand{\Id}{\mathsf{Id}}
%\newcommand{\conv}{=}
%\newcommand{\conv}{\mathsf{conv}}
%\newcommand{\lam}[2]{{\langle}#1{\rangle}#2}
\def\NN{\mathsf{N}}
\def\Nbb{\mathbb{N}}
\def\UU{\mathsf{U}}
\def\JJ{\mathsf{J}}
%\def\Type{\hbox{\sf Type}}
\def\ZERO{\mathsf{0}}
\def\SUCC{\mathsf{S}}

\newcommand{\RawCtx}{{\tt Ctx}}
\newcommand{\RawSub}{{\tt Sub}}
\newcommand{\RawTy}{{\tt Ty}}
\newcommand{\RawTm}{{\tt Tm}}
\newcommand{\type}{\mathsf{type}}
\newcommand{\N}{\mathsf{N}}
\newcommand{\Set}{\mathsf{Set}}
\newcommand{\El}{\mathsf{El}}
%\newcommand{\U}{\mathsf{U}} clashes with def's in new packages
\newcommand{\T}{\mathsf{T}}
\newcommand{\Usuper}{\UU_{\mathrm{super}}}
\newcommand{\Tsuper}{\T_{\mathrm{super}}}
%\newcommand{\conv}{\mathrm{conv}}
\newcommand{\idtoeq}{\mathsf{idtoeq}}
\newcommand{\isEquiv}{\mathsf{isEquiv}}
\newcommand{\ua}{\mathsf{ua}}
\newcommand{\UA}{\mathsf{UA}}
\def\Constraint{\mathsf{Constraint}}
\def\Ordo{\mathcal{O}}
\def\Pihat{\Pi}

%\def\Ctx{\mathrm{ctx}}
%\def\Ty{\mathrm{ty}}
%\def\Tm{\mathrm{tm}}
\def\Obj{\mathrm{obj}}
\def\sub{\mathrm{hom}}
\def\id{\mathrm{id}}
\def\lHom{\mathrm{lhom}}
\def\lctx{\mathrm{lctx}}
\def\lty{\mathrm{level}}
\def\ltm{\mathrm{ltm}}
\def\ltmq{\mathrm{ltmq}}
\def\leq{\mathrm{leq}}
\def\lrefl{\mathrm{lr}}
\def\lp{\mathrm{lp}}
\def\lq{\mathrm{lq}}
\def\s{\mathrm{s}}
\def\lid{\mathrm{lid}}
\def\cctx{\mathrm{cctx}}
\def\cty{\mathrm{cty}}
\def\ctm{\mathrm{ctm}}
\def\cid{\mathrm{cid}}
\def\cp{\mathrm{cp}}
\def\cq{\mathrm{cq}}
\def\chom{\mathrm{chom}}

\newcommand{\ctx}{\mathrm{ctx}}
%\newcommand{\sub}{\mathrm{sub}}
\newcommand{\ty}{\mathrm{ty}}
\newcommand{\tm}{\mathrm{tm}}
%\newcommand{\sub}{\mathrm{hom}}
\newcommand{\tuple}[1]{\langle #1 \rangle}
\def\CComega{\mathrm{CC}^\omega}
\newcommand{\cext}{.}
\def\p{\mathrm{p}}
\def\q{\mathrm{q}}
\def\app{\mathsf{app}}
\def\U{\mathsf{U}}
\def\T{\mathcal{T}}
\newcommand{\Ta}{\mathrm{T}}
\newcommand{\ta}{\mathrm{t}}

\newcommand{\natrec}{\mathsf{natrec}}
%\rightfooter{}
\newcommand{\set}[1]{\{#1\}}
\newcommand{\sct}[1]{[\![#1]\!]}
\def\R{\mathcal{R}}

\def\L{{\mathcal{L}}}
\def\F{\mathcal{C}}
\def\CwF{\mathrm{CwF}}
\def\CwFextSigma{\mathrm{CwF^{ext}_\Sigma}}
\def\CwFintSigma{\mathrm{CwF^{up}_\Sigma}}
\def\CwFext{\mathrm{CwF_{ext}}}
\def\CwFint{\mathrm{CwF_{up}}}
\def\LCwF{\mathrm{LCwF}}
\def\LCwFint{\LCwF_{\mathrm{up}}}
\def\Fam{\mathrm{Fam}}
\def\SCwF{\mathrm{SCwF}}
\def\C{\mathcal{C}}
\def\W{\mathsf{W}}

%\def\TTUP{\mathbf{MLTT^{\UU_l}}}
\def\Sigmaext{{\Sigma^\mathrm{ext}}}
\def\Sigmaint{{\Sigma^\mathrm{up}}}
\def\TText{{\mathbf{TT}^\mathrm{ext}}}
\def\TTint{{\mathbf{TT}^\mathrm{up}}}
\def\Text{\T_\mathrm{ext}}
\def\Tint{\T_\mathrm{up}}

\begin{document}

\title{A Generalized Algebraic Theory\\ for Type Theory
with Explicit Universe Polymorphism
%\footnote{Alternative title: Categorical Models of Type Theory or Type Theory
%with Explicit Universe PolymorphismGeneralised Algebraic Theories of Type Theories with Explicit Universe Polymorphism?}
}

\author{Marc Bezem\\University of Bergen\\\texttt{Marc.Bezem@uib.no}\\
\and Thierry Coquand\\Chalmers University of Technology\\ and University of Gothenburg\\
\texttt{Thierry.Coquand@cse.gu.se}\\ 
\and Peter Dybjer\\Chalmers University of Technology\\ and University of Gothenburg\\
\texttt{peterd@chalmers.se}\\ 
\and Mart\'{\i}n Escard\'o\\University of Birmingham\\
\texttt{m.escardo@bham.ac.uk}\\
}

%Hej, ska ni ut och åka pulka idag också? Det står en pulka i cykelstället utanför mitt hus, om ni vill låna den. Vet inte om den är bättre än de ni har. Här i Båstad är det en underbar vinterdag men kallt -5 grader.
\date{}
\maketitle

\begin{abstract}
We present generalized algebraic theories corresponding to slightly modified versions of two of the type theories in our paper
{\em Type Theory with Explicit Universe Polymorphism}. We first present a generalized algebraic theory for categories with families with extra structure corresponding to Martin-Löf type theory with an external tower of universes. We then present a generalized algebraic theory for level-indexed categories with families with extra structure corresponding to Martin-Löf type theory with explicit universe polymorphism, a theory with universe level judgments, internally indexed universes, and level-indexed products. In this way we get abstract characterizations of the two theories as initial models of their respective generalized algebraic theories. We thus abstract from details of the grammar and inference rules of the type theories and highlight their high-level structure. More broadly, the present work can be viewed as a case study of a uniform approach to categorical logic based on generalized algebraic theories and categories with families. We also discuss the relevance to Voevodsky's initiality conjecture project. \todo[inline]{PD: Add something about level equality sorts? Maybe this is too specific to be mentioned in the abstract? It could be "an interesting feature of the gat for explicit universe polymorphism is that we employ level equality sorts for encoding an equational constraint in the type of codes for universes"? }
\end{abstract}
%
%\section{Introduction}

In our paper {\em Type Theory with Explicit Universe Polymorphism} \cite{BezemCDE22} we proposed several extensions of Martin-Löf type theory with universe polymorphism. We followed Courant's approach \cite{Courant02} and added universe level {\em judgments}:
$$
l\ \level
\hspace{5em}
l = l'
$$
to the usual judgment forms of type theory. Moreover, all judgments may depend on universe level variables as well as ordinary variables declared in the context. We emphasized that, unlike in Agda, universe levels do {\em not} form a {\em type} in our setting, and instead we added the above judgment forms (since then, Agda has introduced, in version 2.6.4, an option for disabling universe levels forming a type~\cite{agda:leveluniv}).  To regain some of the lost expressivity (in a controlled way), we added level-indexed products $[\alpha]A$ of families of types $A\ (\alpha\ \level)$ to our theory.

In this talk we provide alternative presentations of (slightly modified versions of) two of the theories in the above-mentioned paper: Martin-Löf type theory with an external tower of universes $\TText$ and Martin-Löf type theory with explicit universe polymorphism $\TTint$ as outlined in the previous paragraph. We present the corresponding {\em generalized algebraic theories (gats)} $\Sigmaext$ and $\Sigmaint$. Gats were introduce by Cartmell \cite{cartmell:phd,cartmell:apal} as a generalization of many sorted algebraic theories where sort symbols and operator symbols may have dependent types. 

%Our aim is to characterize
%$\TText$ and $\TTint$ as initial models of $\Sigmaext$ and $\Sigmaint$ respectively, provided we decorate some terms (such as applications) with types.

We first present $\Sigmaext$, the infinitary gat of categories with families (cwfs)  \cite{dybjer:torino} with extra structure for the small type formers ($\Pi, \Sigma, \N_0, \N_1, \N, \W, \Id$) of Martin-Löf type theory and a tower of universes $\U_l$ indexed by external natural numbers $l \in \NN$. (We use the letter $\Sigma$ both for $\Sigma$-types and for (presentations of) gats.)

We then present $\Sigmaint$, the finitary gat of level-indexed cwfs with extra structure for the small type formers of Martin-Löf type theory and for level-indexed universes. An indexed cwf consists of a base category $\C$ and a cwf-valued presheaf
$$
P : \C^\op \to \CwF
$$
We get a model for universe polymorphism by letting $\C$ be the category of contexts of a unityped cwf (ucwf) of levels and by equipping $\CwF$ with extra structure for the small type formers. We then add extra structure for level-indexed universes and level-indexed products of types.

As shown in our paper {\em On generalized algebraic theories and categories with families} \cite{bezem:hofmann}, for each finite presentation $\Sigma$ of a gat, there is a general construction of a term model $\T_\Sigma$ and this is initial in the category $\CwF_\Sigma$ of categories with families (cwfs) with a $\Sigma$-structure. The idea is to capture a logical theory $\T$ by a corresponding gat $\Sigma$ such that the term model based on $\T$ is isomorphic to (the externalization of) $\T_\Sigma$. The general construction of an initial term model can be extended to some infinitary gats, such as  $\Sigmaext$~\cite[Section 5.7]{bezem:hofmann}.

A presentation of type theory by a gat of cwfs 
%is a higher-level and more objective notion than a presentation by grammar and inference rules. This is because the gat 
only records the important rules and highlights categorical structure. When building initial models in terms of grammar and inference rules, we make various syntactic choices and include numerous bookkeeping rules and there will be a multitude of options. Our aim is that our high level of abstraction will make it possible to prove equivalence between different options and claim that there is indeed a unique abstract notion of the mathematical theory under consideration.

The present work can be viewed more broadly as a case study for categorical logic based on gats and cwfs. The idea to replace traditional deductive systems by more regular mathematical notions goes back to the early days of categorical logic, as envisaged by Lawvere \cite{lawvere:tac-adjointness}.
%\begin{quotation}
%\emph{
%My 1963 observation (referred to by Eilenberg and Kelly in La Jolla, 1965), that cartesian closed categories serve as a common abstraction of type theory and propositional
%logic, permits an invariant algebraic treatment of the essential problem of proof theory,
%though most of the later work by proof theorists still relies on presentation-dependent
%formulations. ... The strategy to interpret proofs themselves as structures had
%been discussed by Kreisel; however, the influential “realizers” of Kleene are not yet the
%usual mathematical sort of structures.
%}
%\end{quotation}
A similar view has been expressed by Voevodsky \cite{voevodsky:cmu2010}.
%\begin{quotation}
%\emph{
%I will speak about type systems. It is diﬃcult for a mathematician since
%a type system is not a mathematical notion. 
%I will spend a little time
%explaining how I see ``type systems” mathematically. ...
%}
%
%\emph{Thesis 0. Any formal deduction system can be specified in the form of a
%quasi-equational theory.} ...
%
%\emph{Fact 1. Any quasi-equational theory has an initial model.} ...
%
%\emph{This view of formal deduction systems has many advantages. One is that it
%suggests a uniform approach to the formal description of various deductive
%systems. Another one is that ”interpretations” of the deductive system are
%directly connected with the models of the corresponding quasi-equational
%theory.}
%\end{quotation}
%\todo[inline]{Already here we could say: we pursue a variant of Voevodsky's approach: we will use gats rather than quasi-equational theories, and we will use cwfs rather than the C-systems (contextual categories). Gats and cwfs are intimately connected ... cwfs (and variants) are suitable for a uniform approach to deductive logical systems.
%After mentioning the initiality conjecture project we could mention our generic construction of an initial model of a gat.}

Voevodsky considered these issues important for the development of his Univalent Foundations of Mathematics based on dependent type theory. To advance the state
of the art he proposed the {\em Initiality Conjecture project} the goal of which is to define a general class of dependent type theories and to develop generic metatheory for theories in this class. 
%We quote from the introduction of an extended abstract where Voevodsky \cite{voevodsky:initiality} motivates his project:
%\begin{quotation}
%\emph{The first few steps in all approaches to the set-theoretic semantics of dependent
%type theories remain insuﬃciently understood. The constructions which have been
%worked out in detail in the case of a few particular type systems by dedicated authors
%are being extended to the wide variety of type systems under consideration today by
%analogy. This is not acceptable in mathematics. Instead we should be able to obtain
%the required results for new type systems by specialization of general theorems and
%constructions formulated for abstract objects the instances of which combine together
%to produce a given type system.}
%$$
%\vdots
%$$
%\emph{A crucial component of this approach is the expected result that for a particular
%class of inference rules the term model is an initial object in the category of models.
%This is known as the Initiality Conjecture. In the case of the pure Calculus of
%Constructions with a “decorated” application operation this conjecture was proved in
%1988 by Thomas Streicher \cite{streicher:thesis}. The problem of finding an appropriate formulation
%of the general version of the conjecture and of proving this general version will be the
%subject of future work.}
%\end{quotation}
On the surface such initiality proofs may seem straightforward, but they depend on subtle details in the formulation of grammar and inference rules. This is why Voevodsky insisted on calling such theorems ``conjectures'' until proven rigorously and, ideally, implemented in a proof assistant.

%An example of an implemented initiality proof is Brunerie and de Boer's \cite{Brunerie:initiality,deBoer:lic} proof in Agda that a version of Martin-Löf type theory with an external tower of universes is an initial contextual category \cite{cartmell:phd,cartmell:apal} with appropriate extra structure. %Theversion of type theory with de Bruijn variables and implicit substitutions.

In this article we propose an approach to Voevodsky's project based on gats and cwfs. Moreover, this approach actually extends beyond dependent type theory. By considering simply typed cwfs (scwfs) and unityped cwfs we can also capture various simply typed and untyped logical systems as gats and thus widening the scope of {\em uniform categorical logic} based on gats and cwfs, see Castellan, Clairambault, and Dybjer \cite{castellan:lambek}.
%We also discuss the relationship between the gat $\Sigmaint$ and the type theories $\TTint$ presented in Bezem et al  \cite{BezemCDE22} and also between the gat $\Sigmaext$ for Martin-Löf type theory and an externally indexed tower of universes and the corresponding type theory $\TText$.
Moreover, variations of indexed cwfs capture various further logical systems and can be formalized as gats. Untyped predicate logic can be captured by ucwf-indexed scwfs with extra structure for the logical constants. Typed predicate logic can be captured by scwf-indexed scwfs and dependently typed predicate logic (Makkai \cite{makkai:folds}, Gambino and Aczel \cite{gambino-aczel}, Belo \cite{belo}, and Palmgren \cite{Palmgren19}) by cwf-indexed scwfs, both with suitable extra structure for type formers and logical constants.

%\paragraph{Universe polymorphism.} We refer to our previous paper on explicit universe polymorphism \cite{BezemCDE22} for a presentation of the inference rules of Martin-Löf type theory with explicit universe polymorphism, where the reader can also find motivation, examples, and a discussion of related work. Here we only give a brief overview.
%
%An implicit form of universe polymorphism was introduced by Huet \cite{Huet87} and is an essential feature of the proof assistant Rocq (Coq) \cite{rocq:general}. Alternatively, Agda \cite{agda-wiki} and Lean \cite{moura:lean} employ versions of universe polymorphism where universe levels are declared explicitly.
%
%As already mentioned, we followed Courant's approach \cite{Courant02} with universe level judgments. We also presented an extension where equational constraints between universe levels can be declared \cite{BezemCDE22}, building on a proposal by Voevodsky \cite{VV}. This extension can also be described by a gat, but we postpone this topic to a forthcoming paper.
\bibliographystyle{plain}
\bibliography{../refs}
\end{document}
