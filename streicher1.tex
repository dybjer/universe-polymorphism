%\documentclass[12pt,a4paper]{amsart}
\documentclass[11pt,a4paper]{article}
%\ifx\pdfpageheight\undefined\PassOptionsToPackage{dvips}{graphicx}\else%
%\PassOptionsToPackage{pdftex}{graphicx}
\PassOptionsToPackage{pdftex}{color}
%\fi

%\usepackage{diagrams}

%\usepackage[all]{xy}
\usepackage{url}
\usepackage[utf8]{inputenc}
\usepackage{verbatim}
\usepackage{latexsym}
\usepackage{amssymb,amstext,amsmath,amsthm}
\usepackage{epsf}
\usepackage{epsfig}
% \usepackage{isolatin1}
\usepackage{a4wide}
\usepackage{verbatim}
\usepackage{proof}
\usepackage{latexsym}
%\usepackage{mytheorems}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}{Lemma}[theorem]
\newtheorem{proposition}{Proposition}[theorem]
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{remark}{Remark}[theorem]
\newtheorem{TODO}{TODO}[theorem]

\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}


%%%%%%%%%copied from SymmetryBook by Marc

% hyperref should be the package loaded last
%% \usepackage[backref=page,
%%             colorlinks,
%%             citecolor=linkcolor,
%%             linkcolor=linkcolor,
%%             urlcolor=linkcolor,
%%             unicode,
%%             pdfauthor={CAS},
%%             pdftitle={Symmetry},
%%             pdfsubject={Mathematics},
%%             pdfkeywords={type theory, group theory, univalence axiom}]{hyperref}
% - except for cleveref!
\usepackage[capitalize]{cleveref}
%\usepackage{xifthen}
\usepackage{xcolor}
\definecolor{linkcolor}{rgb}{0,0,0.5}

%%%%%%%%%
\def\oge{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\langle\!\langle\,$}}
\def\feg{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\,\rangle\!\rangle$}}

%%%%%%%%%
\newcommand\myfrac[2]{
 \begin{array}{c}
 #1 \\
 \hline \hline
 #2
\end{array}}


\newcommand*{\Scale}[2][4]{\scalebox{#1}{$#2$}}%
\newcommand*{\Resize}[2]{\resizebox{#1}{!}{$#2$}}

\newcommand{\II}{\mathbb{I}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\mkbox}[1]{\ensuremath{#1}}


\newcommand{\Id}{\mathsf{Id}}
\newcommand{\conv}{=}
%\newcommand{\conv}{\mathsf{conv}}
\newcommand{\lam}[2]{{\langle}#1{\rangle}#2}
\def\NN{\mathsf{N}}
\def\UU{\mathsf{U}}
\def\JJ{\mathsf{J}}
\def\Level{\mathsf{Level}}
\def\List{\mathsf{List}}
\def\Cons{\mathsf{Cons}}
\def\Nil{\mathsf{Nil}}
%\def\Type{\hbox{\sf Type}}
\def\ZERO{\mathsf{0}}
\def\SUCC{\mathsf{S}}

\newcommand{\type}{\mathsf{type}}
\newcommand{\LAM}{\mathsf{lam}}
\newcommand{\APP}{\mathsf{app}}
\newcommand{\mypi}[3]{\Pi_{#1:#2}#3}
\newcommand{\mylam}[3]{\lambda_{#1:#2}#3}
\newcommand{\mysig}[3]{\Sigma_{#1:#2}#3}
\newcommand{\N}{\mathsf{N}}
\newcommand{\Set}{\mathsf{Set}}
\newcommand{\El}{\mathsf{El}}
%\newcommand{\U}{\mathsf{U}} clashes with def's in new packages
\newcommand{\T}{\mathsf{T}}
\newcommand{\sT}{\mathsf{t}}
\newcommand{\Usuper}{\UU_{\mathrm{super}}}
\newcommand{\Tsuper}{\T_{\mathrm{super}}}
%\newcommand{\conv}{\mathrm{conv}}
\newcommand{\idtoeq}{\mathsf{idtoeq}}
\newcommand{\isEquiv}{\mathsf{isEquiv}}
\newcommand{\ua}{\mathsf{ua}}
\newcommand{\UA}{\mathsf{UA}}
%\newcommand{\Level}{\mathrm{Level}}
\def\Constraint{\mathsf{Constraint}}
\def\Ordo{\mathcal{O}}

\newcommand{\Con}{\mathsf{ Con}}
\newcommand{\Elem}{\mathsf{Elem}}
\newcommand{\Type}{\mathsf{Type}}
\newcommand{\id}{\mathsf{id}}
\newcommand{\pp}{\mathsf{p}}
\newcommand{\qq}{\mathsf{q}}

\def\Ctx{\mathrm{Ctx}}
\def\Ty{\mathrm{Ty}}
\def\Tm{\mathrm{Tm}}

\def\CComega{\mathrm{CC}^\omega}
\setlength{\oddsidemargin}{0in} % so, left margin is 1in
\setlength{\textwidth}{6.27in} % so, right margin is 1in
\setlength{\topmargin}{0in} % so, top margin is 1in
\setlength{\headheight}{0in}
\setlength{\headsep}{0in}
\setlength{\textheight}{9.19in} % so, foot margin is 1.5in
\setlength{\footskip}{.8in}

% Definition of \placetitle
% Want to do an alternative which takes arguments
% for the names, authors etc.

\newcommand{\natrec}{\mathsf{natrec}}
%\rightfooter{}
\newcommand{\set}[1]{\{#1\}}
\newcommand{\sct}[1]{[\![#1]\!]}
%\usepackage{diagrams}
\usepackage{color}
\newcommand\coloremph[2][red]{\textcolor{#1}{\emph{#2}}}
\newcommand\norm[1]{\left\lVert #1 \right\rVert}
\newcommand\greenemph[2][green]{\textcolor{#1}{\emph{#2}}}
\newcommand{\EMP}[1]{\emph{\textcolor{red}{#1}}}




\begin{document}

\title{Dependent Type Theory with a Cumulative Hierarchy of Universes}

\author{}
\date{}
\maketitle

%\begin{abstract}
%\end{abstract}

\section{Introduction}\label{sec:intros}

There are two different ways to formulate the notion of universe in type theory, introduced in \cite{martinlof:padova}:
Russell style universe, like in \cite{martinlof:hannover}, where a universe is seen as a type of types,
and Tarski style, where each universe is seen as a type of names of types and comes with a decoding function.
Some recent works \cite{Assaf14,Thire20} show the equivalence between these two formulations, but these arguments
do not apply to formulation of type theory with conversion judgements. We also believe this argument to be simpler
and more transparent than the one in \cite{Assaf14,Thire20}.

In order to do this, we adopt Streicher's argument presented in \cite{Streicher:semtt}. This argument relied
on  basic properties of such a type system (such as subject reduction). Such properties were assumed
in \cite{Streicher:semtt}, but they are now known to be provable
for systems with a predicative hieararchy of universes \cite{coquand:sophia,abel:neworleans,abel:wroclaw,coq18} and
The argument goes as follow. There is a natural forgetful map from the Tarski version to the Russell version. Modulo the (known)
  meta-properties of both system, one can show that any Russell judgement can be lifted in a unique way to a Tarski judgement.

\section{Annotated type theory $T_1$ with Tarski style universes}

We now present the system $T_1$ with Tarski style universes. 

The syntax for types is
$$
A,B~::=~\Pi~{A}~B~|~\UU_n~|~\T_n a
$$
and the syntax for terms, with $v_i$ de Bruijn index
$$
a,b~::=~v_i~|~\APP(A,B,c,a)~|~\LAM(A,B,b)~|~\sT^k_n a~|~\UU^k_n~|~\Pi^n~a~b
$$

\medskip

Renaming and substitutions are \EMP{defined} operations. 
$$
r~::=~\pp~|~r^+~~~~~~~~~\sigma~::=~[a]~|~\sigma^+~~~~~~~~~~\alpha~::=~r~|~\sigma
$$
and we define first the renaming operations $ar,~Ar$ by induction on $a,A$ and then the substitution operations
$a\sigma,~A\sigma$ by induction on $a,A$. The actions on variables are
$$
v_i\pp = v_{i+1}~~~~~~v_0[a] = a~~~~~~~~~~v_0\alpha^+ = v_0~~~~~~v_{i+1}\alpha^+ = (v_i\alpha)\pp
$$
We can then define $A\alpha$ (resp. $a\alpha$) by induction on $A$ (resp. $a$).

For instance $(\Pi~A~B)\alpha = \Pi~(A\alpha)~(B\alpha^+)$
and $\APP(A,B,c,a)\alpha = \APP(A\alpha,B\alpha^+,c\alpha,a\alpha)$.

\begin{lemma}
  We have $(B[a])\alpha = B\alpha^+[a\alpha]$ and $(b[a])\alpha = b\alpha^+[a\alpha]$.
\end{lemma}


\medskip

The type system describes how to derive judgements of the form $\Gamma\vdash J$ where $J$ is of the form
$A~\type$ or $a:A$ or $A=B$ or $a=b : A$.

\medskip

$$
\frac{\Gamma\vdash A}{\Gamma.A\vdash}~~~~~~\frac{}{()\vdash}~~~~~~~
\frac{\Gamma\vdash A}{\Gamma.A\vdash v_0:A\pp}~~~~~~~
\frac{\Gamma\vdash v_i:A~~~~~~~\Gamma\vdash B}{\Gamma.B\vdash v_{i+1}:A\pp}~~~~~~~
$$
The judgment $\Gamma\vdash A$ expresses that $A$ is a type in context $\Gamma$.
We may write it $A~\type~(\Gamma)$ and may omit the global context $\Gamma$.
$$
\frac{A~\type~~~~~~B~\type~(A)}{\Pi~A~B~\type}~~~~~~~~~
\frac{b:B~(A)}{\LAM(A,B,b):\Pi~A~B}~~~~~~~~
\frac{c:\Pi~A~B~~~~~~a:A}
     {\APP(A,B,c,a):B[a]}
$$

We write $\conv$ for definitional equality (or conversion).
The main conversion rules are\footnote{We omit systematically {\em congruence} rules
such as the rule that $\APP(A,B,c,a)~\conv~\APP(A',B',c',a')$ follows from
$A~\conv~A'$ and $B~\conv~B'$ and $c~\conv~c'$ and $a~\conv~a'$.}
$$
\frac{ a:A~~~~~~ A~ \conv~ B}{ a:B}~~~~~~~~~
\frac{ a ~\conv~a':A~~~~~~ A  ~\conv~ B}{ a ~\conv~a':B}
$$
$$
\frac{b:B~(A)~~~~~~~~ a:A}{ \APP(A,B,\LAM(A,B,b),a)  ~\conv~ b[a]:B[a]}
~~~~~~~
\frac{f\pp~v_0 = g\pp~v_0:B~(A)}{ f = g : \Pi~A~B}
$$


$$
\UU_n~\type~~~~~~
\frac{A:\UU_{n}}{\T_{n}(A)~\type}~~~~~~
\frac{}{\UU^{k}_l:\UU_{k}}k<l~~~~~~~~~\frac{}{\T_{k}({\UU^{k}_l}) = \UU_{l}}k<l
~~~~~~~~~\frac{A:\UU_{n}}
{\sT_{n}^{m}(A):\UU_{m}}
n\leqslant m
$$
We require for $n\leqslant m$
\[
\T_m(\sT_{n}^{m}(A)) = \T_{n}(A) 
\]
We add  $\sT_{n}^n(a) = a$ and, for $m\leqslant n\leqslant p$
$$
 \sT_{n}^p(\sT_{m}^n(a)) = \sT_m^p(a)
$$
$$
\frac{a:\UU_{n}~~~~~~b:\UU_n~(\T_{n}(a))}
     {\Pi^{n} a b:\UU_{n}}~~~~~~~~~
$$
with conversion rules
$$
\T_{n}~(\Pi^{n} a b) = \Pi~{\T_{n}(a)}~{\T_{n}(b)}~~~~~~~
$$
and
$$
\sT_{n}^{m}~(\Pi^{n} a b) = \Pi^{m} \sT_{n}^{m}(a) \sT_{n}^{m}(b)~~~~~~
\sT_{n}^{m}~(\UU^{n}_k) = \UU^m_k
$$

 We define $\alpha:\Delta\rightarrow\Gamma$ by induction on $\alpha$.
We have $\pp:\Gamma.A\rightarrow\Gamma$ and $[a]:\Gamma\rightarrow \Gamma.A$ and
$\alpha^+:\Delta.A\alpha\rightarrow\Gamma.A$ if $\alpha:\Delta\rightarrow\Gamma$ and $\Gamma\vdash A~\type$.

\begin{lemma}
  The following rule is admissible: if $\Gamma\vdash J$ and $\alpha:\Delta\rightarrow\Gamma$
  then $\Delta\vdash J\alpha$.
\end{lemma}

Assuming $\Pi$ one-to-one, we can then show closure under $\beta$-reduction.

\begin{lemma}
  If $\APP(A,B,\LAM(A',B',b),a):T$ then $b[a]:T$.
\end{lemma}

\begin{proof}
  Using $\Pi$ one-to-one, we get $A=A'$ and $B=B'~(A)$. We then have $b:B~(A)$ and $T = B[a]$.
  We deduce $b[a]:B[a]$ by substitution and $b[a]:T$ by the type equality rule.
\end{proof}

\section{Rules for a type theory $T_2$ with Russell style universes}

The syntax is now for types and terms
$$
A,B,a,b~::=~v_i~|~c~a~|~\lambda b~|~\Pi~{A}~B~|~\UU_n
$$

$$
\frac{A~\type~~~~~~B~\type~(A)}{\Pi~A~B~\type}~~~~~~~~~
\frac{b:B~(A)}{\lambda b:\Pi~A~B}~~~~~~~~
\frac{c:\Pi~A~B~~~~~~a:A}
     {c~a:B[a]}
$$

$$
\UU_n~\type~~~~~~
\frac{A:\UU_{n}}{A~\type}
~~~~~~\frac{A:\UU_{n}}{A:\UU_{n+1}}
~~~~~~~
{\UU_l}:\UU_{l+1}
$$
$$
\frac{A:\UU_{n}~~~~~~B:\UU_n~(A)}
     {\Pi~A~B:\UU_{n}}$$

The main conversion rules are
$$
\frac{ a:A~~~~~~ A~ \conv~ B}{ a:B}~~~~~~~~~
\frac{ a ~\conv~a':A~~~~~~ A  ~\conv~ B}{ a ~\conv~a':B}
$$
$$
\frac{b:B~(A)~~~~~~~~ a:A}{ (\lambda b)~a  ~\conv~ b[a]:B[a]}
~~~~~~~
\frac{f\pp~v_0 ~\conv~ g\pp~v_0:B~(A)}{ f ~\conv~ g : \Pi~A~B}
$$




\medskip

We have an operation which removes the annotation from $T_1$ to $T_2$.
$$
|\UU_n| = \UU_n~~~~~~~~|\Pi~A~B| = \Pi~|A|~|B|~~~~~~~~~|\T_n(a)| = |a|
$$
$$
|\APP(A,B,c,a)| = |c|~|a|~~~~~~|v_i| = v_i~~~~~~|\LAM(A,B,b)| = \lambda |b|~~~~~|\sT_k^n(a)| = |a|
~~~~~~~|\UU^n_l| = \UU_l
$$
The following remark has a direct proof.

\begin{lemma}
  If $\Gamma\vdash J$ in $T_1$ then $|\Gamma|\vdash |J|$ in $T_2$.
\end{lemma}


\section{Equivalence between $T_1$ and $T_2$}

We can describe neutral and $\beta$-normal forms for the non annotated terms.
$$
k~::=~v_i~|~k~n~~~~~~~~~~~n~::=~\UU_l~|~\Pi~n~n~|~\lambda n~|~k
$$


\begin{lemma}
  If $\Gamma\vdash t:A$ and $\Gamma\vdash u:A$ and $|t| = |u|$ is $\beta$-normal then $\Gamma\vdash t = u:A$.
  If $\Gamma\vdash t:A$ and $\Gamma\vdash u:B$ and $|t| = |u|$ is neutral then
  \begin{itemize}
    \item either $A = B$
      and $\Gamma\vdash t = u:A$
    \item or $A = \UU_k$ and $B = \UU_l$ and $\sT_k^m(t) = \sT_l^m(u):\UU_m$ with $m = max(k,l)$.
  \end{itemize}
\end{lemma}

\begin{theorem}
  If $\Gamma\vdash J$ in the system $T_2$ then there exists a unique, up to conversion, judgement $\Gamma_1\vdash J_1$
  in the system $T_1$ such that $|\Gamma_1| = \Gamma$ and $|J_1| = J$.
\end{theorem}

\section{Addition of data types}

The proof extends to the corresponding systems with data types.

For the case of the list types $\List~A$ with constructors $\Nil$ and $\Cons$, we can define in the Russell system
$$
f~:~\List~\UU_0~\rightarrow~\List~\UU_1~~~~~~~~~~~
f~\Nil = \Nil~~~~~~f~(\Cons~x~xs) = \Cons~x~(f~xs)
$$
which can be lifted to in the Tarski version
$$
f~:~\List~\UU_0~\rightarrow~\List~\UU_1~~~~~~~~~~~
f~\Nil = \Nil~~~~~~f~(\Cons~x~xs) = \Cons~(\sT_0^1 x)~(f~xs)
$$
and is extensionally the identity function.
In the Russell system, in the context  $xs:\List~\UU_0$,
we do have $f~xs:\List~\UU_1$ but we do \EMP{not} have $xs:\List~\UU_1$

\medskip

     Similarly, the system $T_2$ is \EMP{not} closed under $\eta$-reduction. In the context
     $$x:\UU_1\rightarrow\UU_1$$, we have $\lambda_yx~y:\UU_0\rightarrow\UU_2$ but we do \EMP{not} have
     $x:\UU_0\rightarrow\UU_2$.




\section{Initial models}

It is possible to present type theory with cumulative hierarchy of universe as a generalised algebraic theory.
The system $T_1$ can be used to present the initial/term model of this theory, following the method presented in \cite{Streicher:semtt}
(method which was formalised in the work \cite{brunerie:initiality}).
Our result shows that Russell's system $T_2$ can be used as well to present this initial/term model.



\bibliographystyle{plain}
\bibliography{refs}

\end{document}
