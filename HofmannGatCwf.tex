\documentclass{lmcs}
%\usepackage{etex}
\usepackage[utf8]{inputenc}

\usepackage{color}
\usepackage{hyperref}
\usepackage{float}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{proof}
\usepackage{mathpartir}
\usepackage{mathrsfs}
\usepackage{stmaryrd}
\usepackage{cmll}
\usepackage{enumerate}
\usepackage{graphicx}
\usepackage[all]{xy}
\usepackage{listings}
\usepackage{todonotes}
\usepackage{Guyboxes}
\input{macros}
%\input{newmacros}
\newtheorem{theorem}{Theorem}
\newcommand{\s}{\mathrm{s}}
\newcommand{\Rec}{\mathrm{R}}
\newcommand{\Ta}{\mathrm{T}}
\newcommand{\ta}{\mathrm{t}}
\newcommand{\Ru}{\mathcal{R}}
\newcommand{\Nhat}{\hat{\N}}
\newcommand{\Pihat}{\hat{\Pi}}
\newcommand{\Tan}{\Ta_n}
\newcommand{\Un}{\U_n}
\newcommand{\Nhatn}{\N^n}
\newcommand{\Pihatn}{\Pi^n}
\newcommand{\Nn}{\Nhatn}
\newcommand{\Pin}{\Pihatn}
\newcommand{\TRu}{\Ta_\Ru}
\newcommand{\URu}{\U_\Ru}
\newcommand{\NRu}{\N_\Ru}
\newcommand{\PiRu}{\Pi_\Ru}
\newcommand{\TRun}{{(\Ta_\Ru)}_n}
\newcommand{\URun}{{(\U_\Ru)}_n}
\newcommand{\NRun}{{(\N_\Ru)}^n}
\newcommand{\PiRun}{{(\Pi_\Ru)}^n}
\newcommand{\TRum}{{(\Ta_\Ru)}_m}
\newcommand{\URum}{{(\\U_\Ru)}_m}
\newcommand{\TC}{\Ta_\C}
\newcommand{\UC}{\U_\C}
\newcommand{\NC}{\N_\C}
\newcommand{\PiC}{\Pi_\C}
\newcommand{\Level}{\mathrm{Level}}
\def\Sort{\mathcal{S}}
\def\Op{\mathcal{O}}
\def\Eq{\mathcal{E}}
\def\Cwf{\mathbf{CwF}}

\title[Generalized Algebraic Theories and Categories with Families]{A Note on Generalized Algebraic Theories\\and Categories with Families}\author{Marc Bezem, Thierry Coquand, Peter Dybjer, Mart\'in Escard\'o}

\begin{document}

\maketitle

\begin{abstract}
We define a new finitary version of generalized algebraic theories. It differs from Cartmell's original syntactic definition in two respects. Whereas Cartmell allows a possibly infinite set of sort and operator symbols, we only allow a finite number. Moreover, our definition is categorical in the sense that it is based on the notion of initial cwf, and abstract in that it is independent of the particular construction of initial cwfs in terms of syntax and inference rules. This is in the spirit of Voevodsky's "initiality conjecture", whereby type theories are characterized as initial objects in appropriate categories of models of type theory.  Our main result is that the category of cwfs supporting a certain signature for gats has an initial object. This result is obtained by extending the construction of initial cwfs from Castellan, Clairambault, and Dybjer. We also point out that cwfs supporting the gats of categories cwfs, are cwfs with internal categories, cwfs, etc.
\end{abstract}

\section{Introduction}

Cartmell's definition of a generalized algebraic theory as a dependently typed generalization of many sorted algebraic theory \cite{cartmell:phd,cartmell:}. Mention his notion of contextual category. Mention Martin Hofmann's notion of category with attributes (cwa) and its relation to contextual categories. Also remark that Cartmell used the name cwa for a slightly different notion. Mention cwfs and Martin Hofmann's paper on "Syntax and Semantics of Dependent Types" which is based on cwfs. (Maybe one could actually elaborate this to a survey of Martin's contributions to the semantics of dependent type theory.) We could motivate this note by saying that it could be added to "Syntax and Semantics of Dependent Types" as yet another basic result for dependent type theory.

Then discuss Cartmell's definition a bit more and his notion of "derived rule". Cartmell's definition of a gat is purely syntactic, with no reference to categories. In particular it is not connected to initiality. On the other hand on of the theorems is an equivalence between the category of gats and the category of contextual categories. I would say that our notion is simpler and immediately gives rise to an initial structure.

Discuss the notion of cwf and why initial cwfs (with extra structure) is appropriate as an "abstract syntax" for dependent type theory, abstracting away from representation detail. Mention Voevodsky's initiality conjecture. Refer to Brunerie.

Also point out that the point of cwfs is to have a categorical notion of model which immediately gives rise to a generalized algebraic theory, a kind of idealized dependently typed syntax. Point out that cwfs and gats are mutually dependent of each other: To know what a cwf is we need to know what a gat is and to know what a gat is we need to know what a cwf is. Point out that cwfs appear on two levels in our account (i) the fundamental (set-theoretic) notion of cwf underlying the definition of gat (ii) the notion of "internal cwf" which is obtained by considering the models of the the gat of cwfs.

200724: 
\begin{itemize}
\item mention "line of work in the spirit of Voevodsky's initiality conjecture", general definition of "a type theory".
\item emphasize that Cartmell's original definition is syntactic. Is it infinitary?
\item typical phenomenon in category that you define something first and only later show that it exists.
\end{itemize}

\section{Categories with families}

Definition of cwfs and the category $\Cwf$.

\section{An abstract definition of generalized algebraic theories}

An official redefinition of Cartmell's notion. 

The {\em signature} for a generalized algebraic theory (gat) $\Sigma$  is given by a list of sort symbols $\Sort$, operator symbols $\Op$, and equations (between terms) $\Eq$, with type information, as follows. (Cartmell also allows equations between sort terms, but most examples do not make use of such, and we skip it for simplicity.) We shall now define how to build a well-formed gat signature $\Sigma$ and what it means for a cwf to support it. This definition relies on the construction of initial cwfs $\T_\Sigma$ supporting $\Sigma$. We proceed by induction on the size of $\Sigma$, but will postpone the construction of the initial cwfs until the next section. In this way we separate the abstract definition from the concrete syntactic details employed for building $\Sigma$.
\begin{description}
\item[The empty generalized algebraic theory] First we define the empty gat $\emptyset = ([],[],[])$ and stipulate that any cwf supports it. 
\end{description}
Assume now that $\Sigma$ is a (well-formed) signature and we have defined what it means for a cwf $\C$ to support it. Assume also that the category $\Cwf_\Sigma$ of cwfs that support $\Sigma$ has an initial object $\T_\Sigma$ with $\inte{-} : \T_\Sigma \to \C$ as the unique cwf-morphism into $\C$. Then we can add a new type symbol, or a new operator symbol, or a new equation, as follows:
\begin{description}
\item[Adding a new sort symbol] 
If $\Gamma$ is a context in $\T_\Sigma$, then we can extend $\Sigma$ with a new sort symbol $F$ (with context $\Gamma$) to obtain an extended gat $\Sigma'$. A cwf $\C$ supports $\Sigma'$ if it supports $\Sigma$ and there is $F_\C \in \Ty_\C(\inte{\Gamma})$.
\item[Adding a new operator symbol] 
If $\Gamma$ is a context in $\T_\Sigma$ and $A \in \Ty_{\T_\Sigma}(\Gamma)$, then we can extend $\Sigma$ with a new operator symbol $f$ (with context $\Gamma$ and type $A$). A cwf $\C$ supports $\Sigma'$ if it supports $\Sigma$ and there is $f_\C \in\Tm_\C(\inte{\Gamma},\inte{A}_{\Gamma})$.
\item[Adding a new equation] 
If $\Gamma$ is a context in $\T_\Sigma$, $A \in \Ty_{\T_\Sigma}(\Gamma)$, and $a, a' \in \Tm_{\T_\Sigma}(\Gamma,A)$, then we can extend $\Sigma$ with a new equation $a = a'$ (with context $\Gamma$ and type $A$). Then a cwf $\C$ that supports $\Sigma'$ is obtained by adding the requirement that $\inte{a}_{\Gamma,A}= \inte{a'}_{\Gamma,A} \in \Tm_\C(\inte{\Gamma},\inte{A}_\Gamma)$.
\end{description}
Note that the empty signature $\emptyset$ is the only well-formed gat signature that can be directly constructed from the definition. In order to form other signatures we need to construct initial cwfs supporting already constructed signatures. This is the topic of the next section.

%\begin{theorem}
%Any generalized algebraic theory $\Sigma$ gives rise to an initial cwf supporting it.
%\end{theorem}

\section{The construction of an initial cwf supporting a gat}

\begin{description}
\item[The empty generalized algebraic theory] 
The category $\Cwf$ of cwfs and strict cwf-morphisms has an initial object \cite{castellan}. This is the initial cwf $\T_\emptyset$ supporting the empty gat.
\end{description}

We recall that this initial cwf is defined by first defining grammars for raw contexts, raw substitutions, raw types, and raw terms. Then four families of partial equivalence relations corresponding to the four judgment forms
\begin{eqnarray*}
\\&&\Gamma = \Gamma' \vdash
\\&&\Delta \vdash \gamma = \gamma' : \Gamma
\\&&\Gamma \vdash A = A'
\\&&\Gamma \vdash a = a' : A
\end{eqnarray*}
are defined inductively by inference rules. The four judgment forms
\begin{eqnarray*}
\\&&\Gamma \vdash
\\&&\Delta \vdash \gamma : \Gamma
\\&&\Gamma \vdash A
\\&&\Gamma \vdash a : A
\end{eqnarray*}
are defined as the reflexive instances of the partial equivalence relations.

Assume we have specified grammars and inference rules for $\T_\Sigma$ and that we write $\vdash_\Sigma$ for derivability by these inference rules. Let $\Sigma'$ be $\Sigma$ extended by a new sort symbol, a new operator symbol, or a new equation. We shall now explain how to build $\T_{\Sigma'}$, to extend the grammars and inference rules for $\T_\Sigma$.
\begin{description}
\item[Adding a new sort symbol] 
If $\Gamma$ is a context in $\T_\Sigma$ and $\Sigma'$ is $\Sigma$ extended with a new sort symbol $F$ (with context $\Gamma$). Then $\T_{\Sigma'}$ is defined by adding the production
$$
A ::= F
$$
to the grammar for raw types, and the inference rule
\begin{mathpar}
    \inferrule
    {}
    {\Gamma \vdash_{\Sigma'} F}
  \end{mathpar}
to the inference rules for $\Sigma$.

We then define $F_{\T_{\Sigma'}} = F$ and it follows that $ \T_{\Sigma'}$ supports $\Sigma'$. 

Moreover, we extend the definition of the interpretation morphism $\inte{-}$  to an interpretation morphism $\inte{-}' : \T_{\Sigma'} \to \C$ by 
$$
\inte{F}' = F_\C
$$
It follows immediately that this is a cwf-morphism and that it is unique.
(Remember remark on equivalence classes.)

\item[Adding a new operator symbol] 
If $\Gamma$ is a context in $\T_\Sigma$, $A \in \Ty_{\T_\Sigma}(\Gamma)$ and $\Sigma'$ is $\Sigma$ extended with a new operator symbol $f$ (with context $\Gamma$ and type $A$). Then $\T_{\Sigma'}$ is defined by adding the production
$$
a ::= f
$$
to the grammar for raw terms, and the inference rule
\begin{mathpar}
    \inferrule
    {}
    {\Gamma \vdash_{\Sigma'} f : A}
\end{mathpar}
to the inference rules for $\Sigma$.

We then define $f_{\T_{\Sigma'}} = f$ and extend the definition of the interpretation morphism $\inte{-}$  to an interpretation morphism $\inte{-}' : \T_{\Sigma'} \to \C$ by 
$$
\inte{f}' = f_\C
$$
(Remember remark on equivalence classes.)
\item[Adding a new equation] 
If $\Gamma$ is a context in $\T_\Sigma$, $A \in \Ty_{\T_\Sigma}(\Gamma)$, $a, a' \in \Tm_{\T_\Sigma}(\Gamma,A)$, and $\Sigma'$ is $\Sigma$ extended with a new equation $a = a'$ (with context $\Gamma$ and type $A$). Then $\T_{\Sigma'}$ is defined by adding the inference rule
 \begin{mathpar}
    \inferrule
    {}
    {\Gamma \vdash_{\Sigma'} a = a' : A}
\end{mathpar}
to the inference rules for $\Sigma$.

It is immediate that $\T_{\Sigma'}$ supports $\Sigma'$.
The interpretation morphism is as before, except that the equivalence classes have changed, so that we need to show that it preserves the new equation. We also need to show uniqueness.
\end{description}

\begin{theorem}
Every signature $\Sigma$ has an initial cwf $\T_\Sigma$ supporting it.
\end{theorem}

\section{Examples of generalized algebraic theories}

\subsection{Categories} The generalized algebraic theory of categories has sort symbols Obj and Hom, operator symbols composition and identity, and associativity and identity laws as equations. 
\begin{itemize}
\item The initial cwf $\T_\emptyset$ has only one object (context) 1, one equivalence class of morphisms $id_1$, and no types and terms. Hence we can add a new constant sort Obj of (internal) objects with context $1$ to the signature. 
\item $\T_{([Obj],[],[])}$ contains the context $(1.Obj).Obj[p_{1,Obj}]$ (corresponding to $x : Obj, y : Obj$ in usual notation with variables). Hence we can introduce the new sort $Hom$ with context $1,Obj.Obj[p_{1,Obj}]$.
\item $\T_{([Obj, Hom],[],[])}$ contains the context $1.Obj$ (corresponding to the context $x : Obj$) and the type $Hom[<<>,pq>,q>]$ (corresponding to the type $Hom(x,x)$ in usual notation). Hence we can introduce the operator symbol $id$ with context $1.Obj$ and type $Hom[<?,?>]$.
\item In a similar way we can verify that the typings of composition and the equations give rise to well-formed signatures, but we omit the details.
\end{itemize}

We say that a cwf that supports the generalized algebraic theory of categories is a cwf with an internal category. Note the similarity and difference with the usual notion of internal category in a category with finite limits.

\subsection{Example: (internal) cwfs} Similarly, we can define a cwf that supports the generalized algebraic theory of cwfs. We add sort symbols for types and terms, operator symbols for all the cwf-combinators, and all the cwf-equations. We say that a cwf that supports this generalized algebraic theory is a cwf with an internal cwf.

\subsection{Example: (internal) cwfs with $\Pi$-types} 
We add operator symbols $\Pi, \lambda, \app$ and equations $\beta, \eta$ to the generalized algebraic theory of cwfs. 

\subsection{Example: (internal) cwfs with $\N$-types} 
We add operator symbols $\N, 0, \s, \Rec$ and equations for $\Rec$.

\subsection{Example: (internal) cwfs with $\U_0$ closed under $\Pi$ and $\N$} 
We add operator symbols $\U_0, \Ta_0$, the code operations $\N^0, \Pi^0$, and the decoding equations.

\subsection{Example: (internal) cwfs with universe tower structures} We introduce a new sort symbol for levels and new operator symbols for 0, $\s$, and $\vee$ for levels with the equations for $\vee$. Then we have the other operator symbols and equations for universe tower structures.

Note that we have here extended the notion of cwf with a sort of levels, that is, we are no longer strictly within the framework of (internal) cwfs.

\subsection{Example: (internal) cwfs with universe polymorphic tower structures} Here we need to extend the cwf-framework further to take into account contexts with level variables, etc.

\section{Generalized algebraic theories and essentially algebraic theories}

It time permits. A remark about the biequivalence between categories with finite limits and democratic cwfs with $\Sigma$ and extensional identity types, as the basis for the correspondence between essentially and generalized algebraic theories.
\end{document}
