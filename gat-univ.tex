\documentclass[11pt,a4paper]{article}
%\ifx\pdfpageheight\undefined\PassOptionsToPackage{dvips}{graphicx}\else%
%\PassOptionsToPackage{pdftex}{graphicx}
\PassOptionsToPackage{pdftex}{color}
%\fi

%\usepackage{diagrams}

%\usepackage[all]{xy}
\usepackage{url}
\usepackage[utf8]{inputenc}
\usepackage{verbatim}
\usepackage{latexsym}
\usepackage{amssymb,amstext,amsmath,amsthm}
\usepackage{epsf}
\usepackage{epsfig}
\usepackage{float}
\usepackage{a4wide}
\usepackage{verbatim}
\usepackage{proof}
\usepackage{latexsym}
%\usepackage{mytheorems}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}{Lemma}[theorem]
\newtheorem{proposition}{Proposition}[theorem]
\theoremstyle{definition}
%\newtheorem{definition}[theorem]{Definition}
%\newtheorem{remark}{Remark}[theorem]
\newtheorem{TODO}{TODO}[theorem]
\newtheorem{remark}{Remark}
\newtheorem{definition}{Definition}

\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}


%%%%%%%%%copied from SymmetryBook by Marc

% hyperref should be the package loaded last
\usepackage[backref=page,
            colorlinks,
            citecolor=linkcolor,
            linkcolor=linkcolor,
            urlcolor=linkcolor,
            unicode,
            pdfauthor={BCDE},
            pdftitle={Universes},
            pdfsubject={Mathematics},
            pdfkeywords={type theory, universes}]{hyperref}
% - except for cleveref!
\usepackage[capitalize]{cleveref}
%\usepackage{xifthen}
\usepackage{xcolor}
\definecolor{linkcolor}{rgb}{0,0,0.5}

%%%%%%%%%
\def\oge{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\langle\!\langle\,$}}
\def\feg{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\,\rangle\!\rangle$}}

%%%%%%%%%

\newcommand{\mkbox}[1]{\ensuremath{#1}}
\newcommand{\eraser}[1]{}

\newcommand{\conv}{=}
%\newcommand{\conv}{\mathsf{conv}}

\newcommand{\Id}{\mathsf{Id}}
\newcommand{\Eq}{\mathsf{Eq}}
\newcommand{\id}{\mathsf{id}}
\newcommand{\NN}{\mathsf{N}}
\newcommand{\Nat}{\mathbb{N}}
\newcommand{\UU}{\mathsf{U}}
\newcommand{\JJ}{\mathsf{J}}
\newcommand{\AgdaLevel}{\mathsf{Level}}
\newcommand{\Level}{\mathsf{level}}
\newcommand{\Lev}{{\mathbb{L}}}
%\newcommand{\Type{\hbox{\sf Type}}
\newcommand{\ZERO}{\mathsf{0}}
\newcommand{\SUCC}{\mathsf{S}}
\newcommand{\valid}{\mathsf{valid}}
%\newcommand{\type}{\mathsf{type}}
\newcommand{\const}{\mathsf{const}}
\newcommand{\lam}[1]{{\langle}#1{\rangle}}
\newcommand{\mylam}[3]{\lambda_{#1:#2}#3}
\newcommand{\mypi}[3]{\Pi_{#1:#2}#3}
\newcommand{\Upi}[3]{\Pi^{#1}\,#2\,#3}
\newcommand{\mysig}[3]{\Sigma_{#1:#2}#3}
\newcommand{\Usig}[3]{\Sigma^{#1}\,#2\,#3}
\newcommand{\app}[2]{{#1\,#2}} % many applications still hard-coded with ~
\newcommand{\Sapp}[1]{\sapp{\SUCC}{#1}}
\newcommand{\sapp}[2]{{#1(#2)}} % strict app for Id, refl, J, natrec, not S (!)
\newcommand{\Idapp}[3]{\sapp{\Id}{#1,#2,#3}}
\newcommand{\Idnapp}[4]{\sapp{\Id^#4}{#1,#2,#3}}
\newcommand{\NRapp}[4]{\sapp{\RR}{#1,#2,#3,#4}}
\newcommand{\Rfapp}[2]{\sapp{\refl}{#1,#2}}
\newcommand{\Japp}[6]{\sapp{\JJ}{#1,#2,#3,#4,#5,#6}}
\newcommand{\RR}{\mathsf{R}}
%\newcommand{\Set}{\mathsf{Set}}
\newcommand{\Group}{\mathsf{Group}}
%\newcommand{\El}{\mathsf{El}}
%\newcommand{\T}{\mathsf{T}}
%\newcommand{\Usuper}{\UU_{\mathrm{super}}}
%\newcommand{\Tsuper}{\T_{\mathrm{super}}}
%\newcommand{\idtoeq}{\mathsf{idtoeq}}
%\newcommand{\isEquiv}{\mathsf{isEquiv}}
%\newcommand{\Equiv}{\mathsf{Equiv}}
\newcommand{\isContr}{\mathsf{isContr}}
%\newcommand{\ua}{\mathsf{ua}}
%\newcommand{\UA}{\mathsf{UA}}
%\newcommand{\natrec}{\mathsf{natrec}}
%\newcommand{\set}[1]{\{#1\}}
%\newcommand{\sct}[1]{[\![#1]\!]}
%\newcommand{\refl}{\mathsf{refl}}
\newcommand{\ttt}[1]{\text{\tt #1}}

%\newcommand{\Level}{\mathrm{Level}}
\newcommand{\Constraint}{\mathsf{Constraint}}
\newcommand{\Ordo}{\mathcal{O}}
\newcommand{\AFu}{\mathcal{A}}
\newcommand{\Fu}{\mathit{Fu}}

\newcommand{\Ctx}{\mathrm{Ctx}}
\newcommand{\Ty}{\mathrm{Ty}}
\newcommand{\Tm}{\mathrm{Tm}}

\newcommand{\CComega}{\mathrm{CC}^\omega}
\setlength{\oddsidemargin}{0in} % so, left margin is 1in
\setlength{\textwidth}{6.27in} % so, right margin is 1in
\setlength{\topmargin}{0in} % so, top margin is 1in
\setlength{\headheight}{0in}
\setlength{\headsep}{0in}
\setlength{\textheight}{9.19in} % so, foot margin is 1.5in
\setlength{\footskip}{.8in}

% Definition of \placetitle
% Want to do an alternative which takes arguments
% for the names, authors etc.

\newcommand\myfrac[2]{
 \begin{array}{c}
 #1 \\
 \hline \hline
 #2
\end{array}}

\def\levelctx{\mathrm{lctx}}
\def\lhom{\mathrm{lhom}}

\newcommand*{\Scale}[2][4]{\scalebox{#1}{$#2$}}%
\newcommand*{\Resize}[2]{\resizebox{#1}{!}{$#2$}}

\newcommand{\II}{\mathbb{I}}
\newcommand{\refl}{\mathsf{refl}}
%\newcommand{\mkbox}[1]{\ensuremath{#1}}


%\newcommand{\Id}{\mathsf{Id}}
%\newcommand{\conv}{=}
%\newcommand{\conv}{\mathsf{conv}}
%\newcommand{\lam}[2]{{\langle}#1{\rangle}#2}
\def\NN{\mathsf{N}}
\def\UU{\mathsf{U}}
\def\JJ{\mathsf{J}}
\def\Level{\mathrm{level}}
%\def\Type{\hbox{\sf Type}}
\def\ZERO{\mathsf{0}}
\def\SUCC{\mathsf{S}}

\newcommand{\RawCtx}{{\tt Ctx}}
\newcommand{\RawSub}{{\tt Sub}}
\newcommand{\RawTy}{{\tt Ty}}
\newcommand{\RawTm}{{\tt Tm}}
\newcommand{\type}{\mathsf{type}}
\newcommand{\N}{\mathsf{N}}
\newcommand{\Set}{\mathsf{Set}}
\newcommand{\El}{\mathsf{El}}
%\newcommand{\U}{\mathsf{U}} clashes with def's in new packages
\newcommand{\T}{\mathsf{T}}
\newcommand{\Usuper}{\UU_{\mathrm{super}}}
\newcommand{\Tsuper}{\T_{\mathrm{super}}}
%\newcommand{\conv}{\mathrm{conv}}
\newcommand{\idtoeq}{\mathsf{idtoeq}}
\newcommand{\isEquiv}{\mathsf{isEquiv}}
\newcommand{\ua}{\mathsf{ua}}
\newcommand{\UA}{\mathsf{UA}}
%\newcommand{\Level}{\mathrm{Level}}
\def\Constraint{\mathsf{Constraint}}
\def\Ordo{\mathcal{O}}
\def\Pihat{\Pi}

\def\Ctx{\mathrm{Ctx}}
\def\Ty{\mathrm{Ty}}
\def\Tm{\mathrm{Tm}}
\def\Obj{\mathrm{obj}}
\def\Hom{\mathrm{hom}}
\def\id{\mathrm{id}}
\def\lHom{\mathrm{lhom}}
\def\lctx{\mathrm{lctx}}
\def\lty{\mathrm{level}}
\def\ltm{\mathrm{ltm}}
\def\lid{\mathrm{lid}}
\def\lp{\mathrm{lp}}
\def\lq{\mathrm{lq}}
\def\s{\mathrm{s}}

\newcommand{\ctx}{\mathrm{ctx}}
\newcommand{\sub}{\mathrm{sub}}
\newcommand{\ty}{\mathrm{ty}}
\newcommand{\tm}{\mathrm{tm}}
%\newcommand{\hom}{\mathrm{hom}}
\newcommand{\tuple}[1]{\langle #1 \rangle}
\def\CComega{\mathrm{CC}^\omega}
\newcommand{\cext}{.}
\def\p{\mathrm{p}}
\def\q{\mathrm{q}}
\def\app{\mathsf{app}}
\def\U{\mathsf{U}}
\def\T{\mathcal{T}}
\newcommand{\Ta}{\mathrm{T}}
\newcommand{\ta}{\mathrm{t}}

\newcommand{\natrec}{\mathsf{natrec}}
%\rightfooter{}
\newcommand{\set}[1]{\{#1\}}
\newcommand{\sct}[1]{[\![#1]\!]}
\def\R{\mathcal{R}}

\def\L{{\mathcal{L}}}
\def\F{\mathcal{C}}
\def\CwF{\mathrm{CwF}}
\def\ScwF{\mathrm{ScwF}}
\def\Cat{\mathrm{Cat}}

\begin{document}

\title{Type Theories with Universe Level Judgements\\
as Initial Models of Generalized Algebraic Theories}

\author{Marc Bezem, Thierry Coquand, Peter Dybjer, Mart\'{\i}n Escard\'o}
\date{}
\maketitle

\begin{abstract}
We give an abstract presentation of  the type theories in our paper
``Type Theories with Universe Level Judgements'' as initial models of some generalized algebraic theories of categories with families with extra structure and as indexed categories with families with extra structure.
\end{abstract}

\section{Introduction}

In a previous paper \cite{bcde:types21} we proposed new versions of type theory with universe polymorphism. The distinctive feature of these theories is that they extend Martin-Löf type theory with new judgments for universe levels:
$
\Gamma \vdash l\ Level
$
and 
$
\Gamma \vdash l = l'.
$
The context $\Gamma$ may contain declarations of universe level variables $\alpha\ Level$. 

In this note we define categorical notions of model of our new type theories. Just as categories with families with extra structure are models of ordinary dependent type theories, we introduced indexed categories with families which model dependent type theories with universe level judgments. Moreover, just as categories with families with extra structure can be specified as models of certain generalized algebraic theories, so is the case with our indexed categories with families.

We define a category of indexed categories with families with extra structure, and conjecture that (a suitable version of) our theory \cite{bcde} yields an initial object in this category.

We refer to Cartmell's original work \cite{cartmell:phd,cartmell:contextual} for an introduction to generalized algebraic theories and to \cite{dybjer:internal} for an introduction to categories with families. Moreover, we refer to \cite{bcde:hofmann} for an abstract definition of generalized algebraic theories as initial categories with families with extra structure. In that paper we also display the generalized algebraic theory of categories with families with extra structure for $\Pi$-types and a universe closed under $\Pi$-types. The generalized algebraic theories in this paper extend that generalized algebraic theory.

\paragraph{Plan of the paper.} We begin by showing the generalized algebraic theory for a version of Martin-Löf type theory with $\Pi$-types and an external tower of universes closed under $\Pi$-types. We show both non-cumulative and cumulative universe towers. 

Then we show generalized algebraic theories for Martin-Löf type theory extended with level judgements and $\Pi$-types and an internal level-indexed universes closed under $\Pi$-types. We show both non-cumulative and cumulative versions here too.

In our paper \cite{bcde:types21} we also present type theories where judgments depend on equational constraints between universe levels. In the final section we discuss the modelling of these theories using generalized algebraic theories.

\section{Type theory with an external tower of universes}

We present the generalized algebraic theory
$$
 \CwF^{\Pi,(\UU_l)_l}
 $$
 of categories with families with $\Pi$-types and an external tower of universes $(\UU_l)_{l \in \NN}$. 
  
We first consider the case without a cumulativity rule. Then we add cumulativity.
 
We can define a category of models of $\CwF^{\Pi,(\UU_l)_l}$, where the morphisms preserve all the structure strictly. We conjecture that (a variant of) the type theories with external towers of universes presented in BCDE \cite{bcde:univ} are initial objects in this category.
  
\subsection{The generalized algebraic theory of categories}

We present $\CwF^{\Pi,(\UU_l)_l}$ step by step and begin with the generalized algebraic theory of categories.
$$
\vspace{0.1ex}
$$

\begin{tiny}
Sort symbols:
\begin{eqnarray*}
&\vdash& \Obj\\
\Delta, \Gamma : \Obj &\vdash& \Hom(\Delta,\Gamma)\\
\end{eqnarray*}

Operator symbols:
\begin{eqnarray*}
\Gamma : \Obj &\vdash& \id_\Gamma : \Hom(\Gamma,\Gamma)\\
\Xi,\Delta,\Gamma : \Obj, \gamma : \Hom(\Delta,\Gamma), \delta : \Hom(\Xi,\Delta) &\vdash&
\gamma \circ \delta : \Hom(\Xi,\Gamma)
\end{eqnarray*}

Equations:
\begin{eqnarray*}
\Delta, \Gamma : \Obj, \gamma : \Hom(\Delta,\Gamma) &\vdash& \id_\Gamma \circ \gamma = \gamma : \Hom(\Delta,\Gamma)\\
\Delta, \Gamma : \Obj, \gamma : \Hom(\Delta,\Gamma) &\vdash& \gamma \circ \id_\Delta = \gamma : \Hom(\Delta,\Gamma)\\
\Theta, \Xi,\Delta,\Gamma : \Obj, \gamma : \Hom(\Delta,\Gamma), \delta : \Hom(\Xi,\Delta), \xi : \Hom(\Theta,\Xi) &\vdash&
(\gamma \circ \delta) \circ \xi = \gamma \circ (\delta \circ \xi): \Hom(\Theta,\Gamma)
\end{eqnarray*}
Note: officially $\circ$ has five arguments rather than two.
\end{tiny}

\subsection{Adding a family valued functor}

A cwf is a category with a terminal object and a family valued functor on that category having a context comprehension structure. Here are the sort symbols, operator symbols, and equations for a family valued functor that are added to the sort symbols, operator symbols, and equations for the theory of categories.
$$
\vspace{0.1ex}
$$

\begin{tiny}
Sort symbols ($\ctx = \Obj$):
\begin{eqnarray*}
\Gamma : \ctx &\vdash& \ty(\Gamma)\\
\Gamma : \ctx, A:\ty(\Gamma) &\vdash& \tm(\Gamma,A)
\end{eqnarray*}

Operator symbols:
\begin{eqnarray*}
\Gamma,\Delta : \ctx, A:\ty(\Gamma), \gamma : \Hom(\Delta,\Gamma) &\vdash&
A[\gamma] : \ty(\Delta)\\
\Gamma,\Delta : \ctx, A:\ty(\Gamma), \gamma : \Hom(\Delta,\Gamma), a:\tm(\Gamma,A) &\vdash&  a[\gamma] : \tm(\Delta,A[\gamma])
\end{eqnarray*}

Equations:
\begin{eqnarray*}
\Gamma : \ctx, A:\ty(\Gamma) &\vdash& A[\id_\Gamma] = A : \ty(\Gamma)\\
\Gamma : \ctx, A:\ty(\Gamma), a:\tm(\Gamma,A) &\vdash& a[\id_\Gamma] = a : \tm(\Gamma,A)\\
\Xi,\Delta,\Gamma : \ctx, \delta : \Hom(\Xi,\Delta), \gamma : \Hom(\Delta,\Gamma),
A:\ty(\Gamma) &\vdash& A[\gamma\circ\delta] = A[\gamma][\delta]: \ty(\Xi)\\
\Xi,\Delta,\Gamma : \ctx, \delta : \Hom(\Xi,\Delta), \gamma : \Hom(\Delta,\Gamma),
A:\ty(\Gamma), a:\tm(\Gamma,A) &\vdash&
a[\gamma\circ\delta] = a[\gamma][\delta]: \tm(\Xi,A[\gamma\circ\delta])
\end{eqnarray*}
We have dropped some of the official arguments here too, and will do so in the following as well.
\end{tiny}


\subsection{Adding a terminal object}

\begin{tiny}
%Sort symbols: none
Operator symbols:
\begin{eqnarray*}
&\vdash& 1 : \ctx\\
\Gamma : \ctx &\vdash& \tuple{}_\Gamma : \Hom(\Gamma,1)
\end{eqnarray*}

Equations:
\begin{eqnarray*}
 &\vdash& \id_1 = \tuple{}_1 : \Hom(1,1)\\
\Gamma,\Delta : \ctx, \gamma : \Hom(\Delta,\Gamma) &\vdash&
\tuple{}_\Gamma\circ\gamma = \tuple{}_\Delta : \Hom(\Delta,1)
\end{eqnarray*}
\end{tiny}


%(The latter two equations are better for term rewriting than the
%obvious single one expressing the uniqueness of $\tuple{}_\Gamma$.)

\subsection{Adding context comprehension}

%No new sorts are added.
\begin{tiny}
Operator symbols:
\begin{eqnarray*}
\Gamma : \ctx, A:\ty(\Gamma) &\vdash& \Gamma\cext A : \ctx\\
\Gamma,\Delta : \ctx, A:\ty(\Gamma), \gamma : \Hom(\Delta,\Gamma), a:\tm(\Delta,A[\gamma]) &\vdash& \tuple{\gamma,a} : \Hom(\Delta,\Gamma\cext A)\\
\Gamma : \ctx, A:\ty(\Gamma) &\vdash& \p: \Hom(\Gamma\cext A,\Gamma)\\
\Gamma : \ctx, A:\ty(\Gamma) &\vdash& \q: \tm(\Gamma\cext A,A[\p])
\end{eqnarray*}

Equations:
\begin{eqnarray*}
\Gamma,\Delta : \ctx, A:\ty(\Gamma), \gamma : \Hom(\Delta,\Gamma), a:\tm(\Delta,A[\gamma]) &\vdash& \p\circ\tuple{\gamma,a} = \gamma : \Hom(\Delta,\Gamma)\\
\Gamma,\Delta : \ctx, A:\ty(\Gamma), \gamma : \Hom(\Delta,\Gamma), a:\tm(\Delta,A[\gamma]) &\vdash& \q[\tuple{\gamma,a}] = a : \tm(\Delta,A[\gamma]) \\
\Gamma,\Delta,\Xi : \ctx, A:\ty(\Gamma), \gamma : \Hom(\Delta,\Gamma), a:\tm(\Delta,A[\gamma]), \delta : \Hom(\Xi,\Delta) &\vdash&
\tuple{\gamma,a} \circ \delta = \tuple{\gamma\circ\delta,a[\delta]} :
\Hom(\Xi,\Gamma\cext A) \\
\Gamma : \ctx, A:\ty(\Gamma) &\vdash&
\id_{\Gamma\cext A} = \tuple{\p,\q} : \Hom(\Gamma\cext A,\Gamma\cext A)
\end{eqnarray*}
\end{tiny}


\subsection{Adding $\Pi$-types}
%We add three operator symbols in addition to the operator symbols for cwfs in Section 5.2 and 5.3:
\begin{tiny}
Operator symbols:
\begin{eqnarray*}
\Gamma : \ctx, A : \ty(\Gamma), B : \ty(\Gamma.A)&\vdash& \Pi(A,B) : \ty(\Gamma)\\
\Gamma : \ctx, A : \ty(\Gamma), B : \ty(\Gamma.A), b : \tm(\Gamma.A, B) &\vdash& \lambda(b) : \tm(\Gamma,\Pi(A,B))\\
\Gamma : \ctx, A : \ty(\Gamma), B : \ty(\Gamma.A), c :  \tm(\Gamma,\Pi(A,B)), a : \tm(\Gamma, A) &\vdash& \app(c,a) : \tm(\Gamma, B[\tuple{\id,a}])
\end{eqnarray*}
Equations (omitting the context and type of the equalities):
 \begin{eqnarray*}
 \app(\lambda(b),a) &=& b[\tuple{\id,a}]\\
 \lambda(\app(c[\p],\q)) &=& c
 \end{eqnarray*}
 Equations for commutativity of operator symbols wrt substitution:
 \begin{eqnarray*}
\Pi(A,B)[ \gamma ] &=& \Pi(A [ \gamma ], B[ \gamma^+ ])\\
\lambda(b) [ \gamma ] &=& \lambda(b[\gamma^+ ])\\
\app(c,a) [ \gamma ] &=& \app(c[ \gamma ], a[ \gamma ] )
\end{eqnarray*}
where $\gamma^+ = \tuple{\gamma \circ \p, \q}$.
\end{tiny}


\subsection{Adding a universe closed under $\Pi$}

\footnote{PD: this will be subsumed by the external tower of universes, but is included for comparison.}
\begin{tiny}
Operator symbols:
\begin{eqnarray*}
\Gamma : \ctx &\vdash& \U_\Gamma : \ty(\Gamma)\\
\Gamma : \ctx, a : \tm(\Gamma,\U_\Gamma) &\vdash& {\Ta}(a) : \ty(\Gamma)\\
%\Gamma : \ctx &\vdash& (\N^0)_\Gamma : \tm(\Gamma,\U_\Gamma) \\
\Gamma : \ctx,
a : \tm(\Gamma,\U_\Gamma),
b :  \tm(\Gamma \cdot \Ta(a), \U_\Gamma))
&\vdash&
 \Pi^0(a,b) : \tm(\Gamma,\U_\Gamma)
\end{eqnarray*}
%$\U_\Gamma$ is the universe (a type) relative to the context $\Gamma$; $\Ta$ is the decoding operation mapping a term in the universe to the corresponding type; $\N^0$ is the code for $\N$ in the universe, and $\Pi^0$ forms codes for $\Pi$-types in the universe. (Note that we have dropped the context argument of $\Ta$ and $\Pi^0$.)
Equation:
\begin{eqnarray*}
%\Ta(\N^0_\Gamma) &=& \N_\Gamma\\
\Ta(\Pi^0(a,b)) &=& \Pi(\Ta(a),\Ta(b))
\end{eqnarray*}
 Equations for commutativity of operator symbols wrt substitution:
 \begin{eqnarray*}
{\U}_\Gamma [ \gamma ] &=& {\U}_\Delta\\
\Ta(a) [ \gamma ] &=& \Ta(a[ \gamma ] )\\
%\N^0_\Gamma [ \gamma ] &=&\N^0_\Delta\\
\Pi^0(a,b)[ \gamma ] &=& \Pi^0(a [ \gamma ], b[ \gamma^+ ])
\end{eqnarray*}
\end{tiny}
%where $\gamma^+ = \tuple{\gamma \circ \p, \q}$.

\subsection{An external non-cumulative tower of universes closed under $\Pi$}

\begin{tiny}
An infinitary theory!
\\
\vspace{1ex}
Operator symbols (for each $l, l', m\in \NN$ and $l < m$). We let $l \vee l' = \max(l,l')$.
\begin{eqnarray*}
\Gamma : \ctx &\vdash& (\U_{l})_\Gamma : \ty(\Gamma)\\
\Gamma : \ctx, a : \tm(\Gamma,(\U_{l})_\Gamma) &\vdash& {\Ta_{l}}(a) : \ty(\Gamma)\\
%\Gamma : \ctx &\vdash& (\N^0)_\Gamma : \tm(\Gamma,(\U_0)_\Gamma) \\
\Gamma : \ctx,
a : \tm(\Gamma,(\U_{l})_\Gamma),
b :  \tm(\Gamma \cdot \Ta_{l}(a), (\U_{l'})_\Gamma))
&\vdash&
 \Pihat^{l,l'}(a,b) : \tm(\Gamma,(\U_{l \vee l'})_\Gamma)\\
 \Gamma : \ctx&\vdash&(\UU^m_l)_\Gamma: \tm(\Gamma,(\UU_{m})_\Gamma)
\end{eqnarray*}
Equation:
\begin{eqnarray*}
%\Ta(\N^0_\Gamma) &=& \N_\Gamma\\
\Ta_{l \vee l'}(\Pi^{l,l'}(a,b)) &=& \Pi(\Ta_l(a),\Ta_{l'}(b))\\
\Ta_{m}((\UU^m_l)_\Gamma) &=& (\UU_l)_\Gamma
\end{eqnarray*}
 Equations for commutativity of operator symbols wrt substitution:
 \begin{eqnarray*}
(\U_l)_\Gamma [ \gamma ] &=& (\U_l)_\Delta\\
\Ta_l(a) [ \gamma ] &=& \Ta_l(a[ \gamma ] )\\
%\N^0_\Gamma [ \gamma ] &=&\N^0_\Delta\\
\Pi^{l,l'}(a,b)[ \gamma ] &=& \Pi^{l,l'}(a [ \gamma ], b[ \gamma^+ ])\\
(\UU^m_l)_\Gamma[ \gamma ] &=&(\UU^m_l)_\Delta
\end{eqnarray*}
\end{tiny}

\subsection{Adding cumulativity}

\begin{tiny}
We add the following operator symbols for lifting for $l < m$:
\begin{eqnarray*}
\Gamma : \ctx, a : \tm(\Gamma,(\U_{l})_\Gamma) &\vdash& {\Ta^m_{l}}(a) : \tm(\Gamma,(\U_{m})_\Gamma))
\end{eqnarray*}
With cumulativity we can simplify the operator symbol for the code for $\Pi$:
\begin{eqnarray*}
\Gamma : \ctx,
a : \tm(\Gamma,(\U_{l})_\Gamma),
b :  \tm(\Gamma \cdot \Ta_{l}(a), (\U_{l})_\Gamma))
&\vdash&
 \Pihat^{l}(a,b) : \tm(\Gamma,(\U_{l})_\Gamma)
\end{eqnarray*}
Equations:
\begin{eqnarray*}
\Ta^m_{l}(\Pi^{l}(a,b)) &=& \Pi^m(\Ta^m_l(a),\Ta^m_l(b))\\
\Ta^m_l((\UU^l_k)_\Gamma) &=& (\UU^m_k)_\Gamma
\end{eqnarray*}
Equations for commutativity of operator symbols wrt substitution ($\gamma : \hom(\Delta,\Gamma)$):
\begin{eqnarray*}
\Ta^m_l(a) [ \gamma ] &=& \Ta^m_l(a[ \gamma ] )\\
%\N^0_\Gamma [ \gamma ] &=&\N^0_\Delta\\
\Pi^{l}(a,b)[ \gamma ] &=& \Pi^{l}(a [ \gamma ], b[ \gamma^+ ])
\end{eqnarray*}
\end{tiny}

\section{Level-indexed type theory}


%A category-indexed cwf (with extra structure for $\Pi$) is a functor 
%$$
%F : C^\mathrm{op} \to \CwF^{\Pi}
%$$
%Our level indexed type theory 
\footnote{Write more generally about level-indexed cwf and hyperdoctrines. Adjointness wrt one level variable. Discuss loop free base category. New constraints. In both cases there is an adjoint.}

In section 4 of \cite{bcde:types} we introduce a type theory with new judgment forms
\begin{itemize}
\item $l\ Level$ meaning that $l$ is a universe level,
\item and $l=l'$ meaning that $l$ and $l'$ are equal universe levels.
\end{itemize}
and rules stating that levels form a sup-semilattices with an inflationary endomorphism $(-)^+$.
We shall present this theory abstractly as an initial {\em ucwf-indexed cwf} $(\L,F)$ with extra structure for level-indexed universes closed under $\Pi$. Here
\begin{itemize}
\item $\L$ is a ucwf of sup-semilattices with an inflationary endomorphism;
\item A contravariant functor
$$
F : \L_\ctx^\mathrm{op} \to \CwF^{\Pi}
$$
from the category of contexts $\L_\ctx$ of $\L$, and $\CwF^\Pi$ is the category where the objects are cwfs with $\Pi$-structures and the morphism preserve the cwf-structure and the $\Pi$-structure on the nose. (For simplicity we present a theory with level-indexed universes closed under $\Pi$-types only. It is straightforward to add closure under other type formers, such as $\Sigma, \N, \Id$, etc.)
\item
Extra structure for level-indexed universes stating that every universe $\U_l$  is in the next $\U_{l^+}$. In the cumulative version there is a map making $\U_l$ a subuniverse of $\UU_m$ if $l \leq m$.
\end{itemize}
Below we shall write down the sort symbols, operator symbols, and equations of the generalized algebraic theory of ucwf-indexed cwf with extra structure for level-indexed universes. 

We can think of $\L$ as the unityped cwf (ucwf) of levels and a cwf-version of the Lawvere theory for upper semilattices with an inflationary endomorphism.

\begin{itemize}
\item 
An object $n$ of $\L$ represents a level context of length $n$. (In general, $n$ is not required to be a natural number. It could, for example, be a list of names of level variables.)
\item
A morphism $\sigma$ in $\L(m,n)$ represents a sequence of level expressions of length $n$ and level variables in $m$.
\item
$F(n)$ is the cwf of contexts, substitutions, types, and terms that depend on $n$ level variables.
\item
The cwf-functor $F(\sigma) : F(n) \to F(m)$ substitutes the $n$ level variables by the level expressions (in $m$ variables) in $\sigma$. 
\end{itemize}

\paragraph{Remark.} Note the similarity with Lawvere's hyperdoctrines \cite{lawvere:hyperdoctrine}. These are contravariant functors (category-indexed families of categories)
$P :  C^\mathrm{op} \to \Cat$ with extra structure for interpreting predicate logic. We remark that ordinary untyped first-order predicate logic can be interpreted by ucwf-indexed scwfs $(T,P)$, 

\begin{itemize}
\item $T$ is a ucwf of tems;
\item A contravariant functor
$$
P : T_\ctx^\mathrm{op} \to \ScwF^{0,1,+,\times,\to}
$$
where $\ScwF^{0,1,+,\times,\to}$ is the category of simply typed cwfs with extra structure for interpreting the propositional connectives.
\item
Extra structure for the quantifiers $\forall, \exists$, similar to the structure of a hyperdoctrine where quantifiers are adjoints to the substitution functor.
\end{itemize}
Several other logical systems can be captured by variants of indexed cwfs\footnote{PD: I don't suggest this is included in the paper. It's too much of a topic in its own right, and it needs more investigation.}. For example,
\begin{itemize}
\item scwf-indexed scwfs capture typed predicate logic;
\item cwf-indexed scwfs (with extras structure) capture logic-enriched type theory in the sense of Makkai, Aczel and Gambino, and Belo;
\item ucwf-indexed scwfs with extra structure for function types and type quantification capture system F.
\item ucwf-indexed cwfs capture cubical type theory. (Check!)
\end{itemize}


%\begin{itemize}
%\item
%Object part of the functor $\L \to \CwF^{\Pi,\UU_l}$
%\begin{itemize}
%\item Level-indexed contexts and context-morphisms
%\item Level-indexed types and terms
%\end{itemize}
%\item
%Arrow part of the functor $\L \to \CwF^{\Pi,\UU_l}$
%\begin{itemize}
%\item Level-substitution in contexts and context-morphisms
%\item Level-substitution in types and terms
%\end{itemize}
%\end{itemize}


\subsection{The ucwf of levels: sort and operator symbols}

\begin{tiny}
Sort symbols:
\begin{eqnarray*}
&\vdash& \lctx\\
m, n : \lctx &\vdash& \lHom(m,n)\\
%\Gamma : \lctx &\vdash& \lty(\Gamma)\\
m : \lctx &\vdash& \ltm(m)
\end{eqnarray*}

Operator symbols:
\begin{eqnarray*}
m : \lctx &\vdash& \lid_m : \lhom(m,m)\\
m, n, p : \lctx, \gamma : \lhom(n,p), \delta : \lhom(m,n) &\vdash&
\gamma \circ \delta : \lhom(m,p)\\
&&\\
m,n: \lctx, \gamma : \lhom(n,m), l :\ltm(m,A) &\vdash&  l[\gamma] : \ltm(n)\\
&&\\
&\vdash& 0 : \lctx\\
m : \lctx &\vdash& \tuple{}_m : \lhom(m,0)\\
&&\\
m : \lctx &\vdash& \s(m) : \lctx\\
m,n : \ctx, \gamma : \lhom(n,m), l:\ltm(n) &\vdash& \tuple{\gamma,l} : \lhom(n,\s(m))\\
m : \ctx &\vdash& \p: \Hom(\s(m),m)\\
m : \ctx &\vdash& \q: \tm(\s(m))\\
&&\\
m : \lctx, l : \ltm(m) &\vdash& l^+ : \ltm(m)\\
m : \lctx, l,l' : \ltm(m) &\vdash& l \vee l' : \ltm(m)
\end{eqnarray*}
\end{tiny}
Equations:

\begin{tiny}
All ucwf-equations (same as the cwf-equations in 1.1 - 1.4, but removing type equations, since there is only one type).
\begin{eqnarray*}
&\vdots&
\end{eqnarray*}
Semi-lattice equations for $l \vee l'$
\begin{eqnarray*}
(l \vee l') \vee l'' &=& l \vee (l' \vee l'')\\
l \vee l' &=& l'\vee l\\
l \vee l &=& l
\end{eqnarray*}
Equations for $l^+$.
\begin{eqnarray*}
l \vee l^+ &=& l^+\\
(l\vee l')^+ &=& l^+\vee l'^+
\end{eqnarray*}
Commutativity of $\vee$ and $+$ with level substitution.
\begin{eqnarray*}
l^+[\gamma]&=&(l[\gamma])^+\\
(l \vee l')[\gamma]&=&(l[\gamma])\vee(l'[\gamma])
\end{eqnarray*}
\end{tiny}

\subsection{Level-indexed categories of contexts}

\begin{tiny}
There is a category above each level-context $n$:
\\
Sort symbols:
\begin{eqnarray*}
n : \lctx &\vdash& \ctx_n\\
n : \lctx, \Delta, \Gamma : \ctx_n &\vdash& \Hom_n(\Delta,\Gamma)\\
\end{eqnarray*}

Operator symbols:
\begin{eqnarray*}
n : \lctx, \Gamma : \ctx_n &\vdash& \id_{n,\Gamma} : \Hom_n(\Gamma,\Gamma)\\
n : \lctx, \Xi,\Delta,\Gamma : \ctx_n, \gamma : \Hom_n(\Delta,\Gamma), \delta : \Hom_n(\Xi,\Delta) &\vdash&
\gamma \circ \delta : \Hom_n(\Xi,\Gamma)
\end{eqnarray*}

Equations:
\begin{eqnarray*}
\id_{n,\Gamma} \circ \gamma &=& \gamma \\
 \gamma \circ \id_{n,\Delta} &=& \gamma \\
(\gamma \circ \delta) \circ \xi &=& \gamma \circ (\delta \circ \xi)
\end{eqnarray*}
Note: officially $\circ$ has six arguments rather than two.
\end{tiny}

\subsection{Level substitution in contexts and context-morphisms}

\begin{tiny}
Operator symbols (overloaded notation):
\begin{eqnarray*}
n, n' : \lctx , \sigma : \lhom(n,n'), \Gamma : \ctx_{n'} &\vdash& 
\Gamma[\sigma] : \ctx_n\\
n, n' : \lctx , \sigma : \lhom(n,n'), \Delta,\Gamma : \ctx_{n'}, \gamma : \Hom_{n'}(\Delta,\Gamma) 
&\vdash& 
\gamma[\sigma] : \Hom_{n}(\Delta[\sigma],\Gamma[\sigma]) 
\end{eqnarray*}
Equations:
\begin{eqnarray*}
\Gamma[\lid_n] &=& \Gamma\\
\Gamma[\sigma \circ \sigma'] &=& \Gamma[\sigma][\sigma']\\
\gamma[\lid_n] &=& \gamma\\
\gamma[\sigma \circ \sigma'] &=& \gamma[\sigma][\sigma']
\end{eqnarray*}
Etc, for level-indexing the other components of cwfs and of $\Pi$-types.
\end{tiny}

%\subsection{Level-indexed family-valued functor}
%
%In analogy with the previous section, all the operations of family-valued functors are indexed by level-contexts, and we can do level-substitution in types and terms. Moreover, we need laws relating ordinary substitution and level-substitution.
%
%\subsection{Level-indexed terminal object}
%
%Similar.
%
%\subsection{Level-indexed context comprehension}
%
%Similar.
%
%\subsection{Level-indexed $\Pi$-types}
%
%Similar.

\subsection{A level-indexed non-cumulative tower of universes}

A finitary theory! The operator symbols and equations are analogous to the external case, but levels are now abstract rather than natural numbers. What about level-substitution?
\\
\vspace{1ex}
\begin{tiny}
Operator symbols:
\begin{eqnarray*}
n : \lctx, l : \ltm(n), \Gamma : \lctx_n &\vdash& (\U_{l})_\Gamma : \ty_n(\Gamma)\\
n : \lctx, l : \ltm(n), \Gamma : \ctx_n, a : \tm_n(\Gamma,(\U_{l})_\Gamma) &\vdash& {\Ta_{l}}(a) : \ty_n(\Gamma)\\
%\Gamma : \ctx &\vdash& (\N^0)_\Gamma : \tm(\Gamma,(\U_0)_\Gamma) \\
n : \lctx, l, l' : \ltm(n), \Gamma : \ctx_n,
a : \tm_n(\Gamma,(\U_{l})_\Gamma),
b :  \tm_n(\Gamma \cdot \Ta_{l}(a), (\U_{l'})_\Gamma))
&\vdash&
 \Pihat^{l,l'}(a,b) : \tm_n(\Gamma,(\U_{l \vee l'})_\Gamma)\\
 n : \lctx, l : \ltm(n),\Gamma : \ctx_n&\vdash&\UU^l_\Gamma: \tm_n(\Gamma,(\UU_{l^+})_\Gamma)
\end{eqnarray*}
Equations:
\begin{eqnarray*}
(\U_{l})_\Gamma)[\sigma] &=& \U_{l[\sigma]})_{\Gamma[\sigma]}\\
&\vdots&
\end{eqnarray*}

\end{tiny}

\subsection{Adding cumulativity}

(This is identical to the external case, except that levels are now from an abstract semi-lattice.)
\begin{tiny}
We add the following operator symbols for lifting for $l < m$:
\begin{eqnarray*}
\Gamma : \ctx, a : \tm(\Gamma,(\U_{l})_\Gamma) &\vdash& {\Ta^m_{l}}(a) : \tm(\Gamma,(\U_{m})_\Gamma))
\end{eqnarray*}
With cumulativity we can simplify the operator symbol for the code for $\Pi$:
\begin{eqnarray*}
\Gamma : \ctx,
a : \tm(\Gamma,(\U_{l})_\Gamma),
b :  \tm(\Gamma \cdot \Ta_{l}(a), (\U_{l})_\Gamma))
&\vdash&
 \Pihat^{l}(a,b) : \tm(\Gamma,(\U_{l})_\Gamma)
\end{eqnarray*}
Equations:
$$
\vdots
$$
\end{tiny}

\subsection{Level-indexed products of types}
%We add three operator symbols in addition to the operator symbols for cwfs in Section 5.2 and 5.3:
\def\l{\mathrm{l}}
\begin{tiny}
Operator symbols (universal level quantification, abstraction, and application):
\begin{eqnarray*}
n : \lctx, \Gamma : \ctx_n, B : \ty_{\s(n)}(\Gamma[\lp])&\vdash& \forall_\l(B) : \ty_n(\Gamma)\\
n : \lctx, \Gamma : \ctx_n, B : \ty_{\s(n)}(\Gamma[\lp]), b : \tm_{\s(n)}(\Gamma[\lp], B) &\vdash& \lambda_\l(b) : \tm_n(\Gamma,\forall_\l(B))\\
n : \lctx, \Gamma : \ctx_n, B : \ty_{\s(n)}(\Gamma[\lp]), c :  \tm_n(\Gamma,\forall_\l(B)), l : \ltm(n) &\vdash& \app_\l(c,l) : \tm_n(\Gamma, B[\tuple{\lid,l}])
\end{eqnarray*}
Equations ($\beta$ and $\eta$ for level abstraction and application):
 \begin{eqnarray*}
 \app_\l(\lambda_\l(b),l) &=& b[\tuple{\lid,l}]\\
 \lambda_\l(\app_\l(c[\lp],\lq)) &=& c
 \end{eqnarray*}
 Equations for commutativity of operator symbols wrt a level substitution $\sigma : \lhom(m,n)$ and a term substitution $\gamma : \hom_n(\Delta,\Gamma)$:
 \begin{eqnarray*}
 \forall_\l(B)[ \sigma ] &=& \forall_\l(B[ \sigma^{+}])\\
 \forall_\l(B)[ \gamma ] &=& \forall_\l(B[ \gamma^+ ])\\
&\vdots&
\end{eqnarray*}
where $\sigma^+ = \tuple{\sigma \circ \lp, \lq}$ and $\gamma^+ = \tuple{\gamma \circ \p, \q}$??
\end{tiny}

\section{Models of theories with equational universe level constraints}

The simplest idea is to model a theory with the universe level constraint $l = l'$ as a gat with that constraint added as a new equation.

\end{document}